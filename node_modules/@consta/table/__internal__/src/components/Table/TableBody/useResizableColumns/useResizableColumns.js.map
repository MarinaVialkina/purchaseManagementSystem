{"version":3,"file":"useResizableColumns.js","names":["useCreateAtom","useSendToAtom","useAction","useUpdate","useEffect","addResult","getCalculatedSizes","getRefsSizes","sizesEq","useResizeContainer","useResizableColumns","props","propsAtom","blocksLengthAtom","ctx","get","blocks","length","blocksAtom","spy","resizableAtom","resizable","containerAtom","container","sizesAtom","activeIndexAtom","resizingAtom","setSizes","newSizes","controlListeners","_","type","method","document","handleRelease","handleTouchMove","handlePress","index","event","activeIndex","sizes","handlersAtom","Array","from","map","_el","onMouseDown","onTouchStart"],"sources":["../../../../../../../src/components/Table/TableBody/useResizableColumns/useResizableColumns.ts"],"sourcesContent":["import { useCreateAtom } from '@consta/uikit/__internal__/src/utils/state/useCreateAtom';\nimport { useSendToAtom } from '@consta/uikit/__internal__/src/utils/state/useSendToAtom';\nimport { useAction, useUpdate } from '@reatom/npm-react';\nimport { useEffect } from 'react';\n\nimport {\n  addResult,\n  getCalculatedSizes,\n  getRefsSizes,\n  sizesEq,\n  useResizeContainer,\n} from './helpers';\nimport { UseResizableColumnsProps } from './types';\n\nexport const useResizableColumns = (props: UseResizableColumnsProps) => {\n  const propsAtom = useSendToAtom(props);\n  const blocksLengthAtom = useCreateAtom(\n    (ctx) => ctx.get(propsAtom).blocks.length,\n  );\n  const blocksAtom = useCreateAtom((ctx) => ctx.spy(propsAtom).blocks);\n  const resizableAtom = useCreateAtom((ctx) => ctx.spy(propsAtom).resizable);\n\n  const containerAtom = useCreateAtom((ctx) => ctx.spy(propsAtom).container);\n\n  const { blocks } = props;\n\n  const sizesAtom = useCreateAtom(getRefsSizes(blocks));\n\n  const activeIndexAtom = useCreateAtom<number | null>(null);\n  const resizingAtom = useCreateAtom(\n    (ctx) => typeof ctx.spy(activeIndexAtom) === 'number',\n  );\n\n  const setSizes = useAction(\n    (ctx, newSizes: (string | number | undefined)[]) => {\n      if (!sizesEq(newSizes, ctx.get(sizesAtom))) {\n        sizesAtom(ctx, newSizes);\n      }\n    },\n  );\n\n  const controlListeners = useAction((_, type: 'add' | 'remove') => {\n    const method = type === 'add' ? 'addEventListener' : 'removeEventListener';\n    document[method]('mouseup', handleRelease);\n    document[method]('touchend', handleRelease);\n    document[method]('mousemove', handleTouchMove);\n    document[method]('touchmove', handleTouchMove);\n  });\n\n  const handleRelease = useAction((ctx) => {\n    activeIndexAtom(ctx, null);\n    controlListeners('remove');\n  });\n\n  const handlePress = useAction((ctx, index: number) => {\n    activeIndexAtom(ctx, index);\n    controlListeners('add');\n  });\n\n  const handleTouchMove = useAction(\n    (ctx, event: MouseEvent | TouchEvent | Event) => {\n      const { container, blocks, resizable } = ctx.get(propsAtom);\n      const activeIndex = ctx.get(activeIndexAtom);\n\n      if (typeof activeIndex === 'number' && resizable) {\n        const sizes = ctx.get(sizesAtom);\n\n        setSizes(\n          addResult(\n            getCalculatedSizes(\n              event,\n              activeIndex,\n              blocks,\n              container,\n              sizes,\n              resizable,\n            ),\n            sizes,\n          ),\n        );\n      }\n    },\n  );\n\n  const handlersAtom = useCreateAtom((ctx) => {\n    const length = ctx.spy(blocksLengthAtom);\n    const resizable = ctx.spy(resizableAtom);\n    if (!resizable) {\n      return [];\n    }\n\n    return Array.from({ length }).map((_el, index) => ({\n      onMouseDown: () => handlePress(index),\n      onTouchStart: () => handlePress(index),\n    }));\n  });\n\n  useResizeContainer(\n    containerAtom,\n    blocksAtom,\n    resizableAtom,\n    sizesAtom,\n    setSizes,\n  );\n\n  useUpdate(\n    (_, blocks) => {\n      setSizes(getRefsSizes(blocks));\n    },\n    [blocksAtom, resizableAtom],\n  );\n\n  useUpdate(\n    (_, resizable) => {\n      !resizable && handleRelease();\n    },\n    [resizableAtom],\n  );\n\n  useEffect(() => {\n    return handleRelease;\n  }, []);\n\n  return {\n    handlersAtom,\n    sizesAtom,\n    activeIndexAtom,\n    resizingAtom,\n  };\n};\n"],"mappings":"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"}