import _toConsumableArray from "@babel/runtime/helpers/toConsumableArray";
import _slicedToArray from "@babel/runtime/helpers/slicedToArray";
import { useAction, useAtom } from '@reatom/npm-react';
import { useLayoutEffect } from 'react';
export var useVisibleColumns = function useVisibleColumns(refs, intersectingColumnsAtom, rootAtom) {
  var _useAtom = useAtom(rootAtom),
      _useAtom2 = _slicedToArray(_useAtom, 1),
      root = _useAtom2[0];

  var setIntersectingColumns = useAction(function (ctx, index, value) {
    var state = ctx.get(intersectingColumnsAtom);

    var newState = _toConsumableArray(state);

    newState[index] = value;
    intersectingColumnsAtom(ctx, newState);
  });
  useLayoutEffect(function () {
    var observers = [];

    if (root) {
      var _loop = function _loop(index) {
        var ref = refs[index];
        var observer = new IntersectionObserver(function (entries) {
          return setIntersectingColumns(index, entries[0].isIntersecting);
        }, {
          root: root
        });
        ref.current && observer.observe(ref.current);
      };

      for (var index = 0; index < refs.length; index++) {
        _loop(index);
      }
    }

    return function () {
      observers.forEach(function (observer) {
        return observer.disconnect();
      });
    };
  }, [refs, root]);
};
//# sourceMappingURL=useVisibleColumns.js.map