{"version":3,"file":"TableResizers.js","names":["useSendToAtom","useRefs","useAtom","React","forwardRef","memo","cn","useVisibleColumns","cnTableResizers","TableResizer","ref","resizableAtom","maxWidth","minWidth","isSeparator","pinned","index","lowHeadersLength","handlersAtom","activeIndexAtom","virtualScrollHelperRef","resizable","handlers","indexAtom","ctx","spy","active","undefined","TableResizers","props","lowHeadersAtom","resizersRefsAtom","intersectingColumnsAtom","bodyElAtom","resizersRefs","lowHeaders","virtualScrollHelperRefs","length","map"],"sources":["../../../../../../src/components/Table/TableResizers/TableResizers.tsx"],"sourcesContent":["import './TableResizers.css';\n\nimport { useSendToAtom } from '@consta/uikit/__internal__/src/utils/state/useSendToAtom';\nimport { PropsWithHTMLAttributesAndRef } from '@consta/uikit/__internal__/src/utils/types/PropsWithHTMLAttributes';\nimport { useRefs } from '@consta/uikit/useRefs';\nimport { AtomMut } from '@reatom/core';\nimport { useAtom } from '@reatom/npm-react';\nimport React, { forwardRef, memo } from 'react';\n\nimport { cn } from '##/utils/bem';\n\nimport { TableColumn } from '../types';\nimport { useVisibleColumns } from './useVisibleColumns';\n\ntype TableResizersProps<T> = {\n  lowHeadersAtom: AtomMut<TableColumn<T>[]>;\n  resizersRefsAtom: AtomMut<React.RefObject<HTMLDivElement>[]>;\n  handlersAtom: AtomMut<\n    {\n      onMouseDown: () => void;\n      onTouchStart: () => void;\n    }[]\n  >;\n  resizableAtom: AtomMut<'inside' | 'outside' | undefined>;\n  activeIndexAtom: AtomMut<number | null>;\n  intersectingColumnsAtom: AtomMut<boolean[]>;\n  bodyElAtom: AtomMut<HTMLDivElement | null>;\n};\n\nexport type TableResizersComponent = <T>(\n  props: TableResizersProps<T>,\n) => React.ReactNode | null;\n\nconst cnTableResizers = cn('TableResizers');\n\ntype TableResizerProps<T> = PropsWithHTMLAttributesAndRef<\n  TableColumn<T> & {\n    resizableAtom: AtomMut<'inside' | 'outside' | undefined>;\n    index: number;\n    lowHeadersLength: number;\n    handlersAtom: AtomMut<\n      {\n        onMouseDown: () => void;\n        onTouchStart: () => void;\n      }[]\n    >;\n    activeIndexAtom: AtomMut<number | null>;\n    virtualScrollHelperRef: React.RefObject<HTMLDivElement>;\n  },\n  HTMLDivElement\n>;\n\nexport type TableResizerComponent = <T>(\n  props: TableResizerProps<T>,\n) => React.ReactNode | null;\n\nconst TableResizer: TableResizerComponent = forwardRef(\n  (\n    {\n      resizableAtom,\n      maxWidth,\n      minWidth,\n      isSeparator,\n      pinned,\n      index,\n      lowHeadersLength,\n      handlersAtom,\n      activeIndexAtom,\n      virtualScrollHelperRef,\n    },\n    ref,\n  ) => {\n    const [resizable] = useAtom(resizableAtom);\n    const [handlers] = useAtom(handlersAtom);\n    const indexAtom = useSendToAtom(index);\n    const [active] = useAtom(\n      (ctx) => ctx.spy(indexAtom) === ctx.spy(activeIndexAtom),\n    );\n\n    return (\n      <div\n        className={cnTableResizers('Cell')}\n        ref={ref}\n        style={{\n          ['--table-resizer-top-offset' as string]: `var(--table-resizer-top-offset-${index})`,\n        }}\n      >\n        <div\n          ref={virtualScrollHelperRef}\n          className={cnTableResizers('VirtualScrollHelper')}\n        />\n        {resizable &&\n          (maxWidth === undefined || maxWidth !== minWidth) &&\n          !isSeparator &&\n          !pinned &&\n          !(resizable === 'inside' && lowHeadersLength === index + 1) && (\n            <div\n              {...handlers[index]}\n              className={cnTableResizers('Resizer', {\n                active,\n              })}\n              aria-hidden\n            />\n          )}\n      </div>\n    );\n  },\n);\n\nexport const TableResizers: TableResizersComponent = memo((props) => {\n  const {\n    lowHeadersAtom,\n    resizersRefsAtom,\n    handlersAtom,\n    resizableAtom,\n    activeIndexAtom,\n    intersectingColumnsAtom,\n    bodyElAtom,\n  } = props;\n  const [resizersRefs] = useAtom(resizersRefsAtom);\n  const [lowHeaders] = useAtom(lowHeadersAtom);\n  const virtualScrollHelperRefs = useRefs<HTMLDivElement>(lowHeaders.length);\n\n  useVisibleColumns(\n    virtualScrollHelperRefs,\n    intersectingColumnsAtom,\n    bodyElAtom,\n  );\n\n  return (\n    <div className={cnTableResizers()}>\n      {lowHeaders.map(({ maxWidth, minWidth, pinned, isSeparator }, index) => (\n        <TableResizer\n          resizableAtom={resizableAtom}\n          key={index}\n          ref={resizersRefs[index]}\n          virtualScrollHelperRef={virtualScrollHelperRefs[index]}\n          maxWidth={maxWidth}\n          minWidth={minWidth}\n          pinned={pinned}\n          isSeparator={isSeparator}\n          index={index}\n          lowHeadersLength={lowHeaders.length}\n          handlersAtom={handlersAtom}\n          activeIndexAtom={activeIndexAtom}\n        />\n      ))}\n    </div>\n  );\n});\n"],"mappings":"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"}