{"version":3,"file":"Collapse.js","names":["withCtx","isString","animateTimeout","Text","useMutableRef","useAction","useAtom","useUpdate","React","forwardRef","useRef","Transition","Toolbar","cn","CollapseButton","CollapseExpandIcon","CollapseFullscreen","CollapseFullscreenIcon","cnCollapse","Collapse","props","ref","expandButton","expanded","expandedProp","onExpand","fullscreenButton","fullscreen","fullscreenProp","onFullscreen","leftSide","rightSide","className","children","fullscreenContainer","window","document","body","fullscreenZIndex","expandedMaxHeight","otherProps","refs","contentRef","expandedAtom","fullscreenAtom","undefined","fakeContentHeight","setFakeContentHeight","expandedContentMounted","expandedContentMountedAtom","toggleExpanded","ctx","e","value","get","current","toggleFullscreen","clientHeight","afterExitExpanded","title","Array","isArray","height","maxHeight"],"sources":["../../../../../src/components/Collapse/Collapse.tsx"],"sourcesContent":["import './Collapse.css';\n\nimport { withCtx } from '@consta/uikit/__internal__/src/utils/state/withCtx';\nimport { isString } from '@consta/uikit/__internal__/src/utils/type-guards';\nimport { animateTimeout } from '@consta/uikit/MixPopoverAnimate';\nimport { Text } from '@consta/uikit/Text';\nimport { useMutableRef } from '@consta/uikit/useMutableRef';\nimport { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { forwardRef, useRef } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { Toolbar } from '##/components/Toolbar';\nimport { cn } from '##/utils/bem';\n\nimport { CollapseButton } from './CollapseButton';\nimport { CollapseExpandIcon } from './CollapseExpandIcon';\nimport { CollapseFullscreen } from './CollapseFullscreen';\nimport { CollapseFullscreenIcon } from './CollapseFullscreenIcon';\n\nconst cnCollapse = cn('Collapse');\n\nexport type CollapseProps = JSX.IntrinsicElements['div'] & {\n  expandButton?: boolean;\n  expanded?: boolean;\n  expandedMaxHeight?: number | 'auto';\n  onExpand?: (value: boolean, e: React.MouseEvent<HTMLButtonElement>) => void;\n  fullscreenButton?: boolean;\n  fullscreen?: boolean;\n  onFullscreen?: (\n    value: boolean,\n    e: React.MouseEvent<HTMLButtonElement>,\n  ) => void;\n  leftSide: React.ReactNode;\n  rightSide?: React.ReactNode;\n  fullscreenContainer?: Element | React.RefObject<HTMLElement>;\n  fullscreenZIndex?: number;\n};\n\n/**\n * Props for the Collapse component.\n *\n * @extends JSX.IntrinsicElements['div']\n * @property {boolean} [expandButton] - показывает кнопку раскрытия..\n * @property {boolean} [expanded=false] - указывает, раскрыт ли компонент.\n * @property {number | 'auto'} [expandedMaxHeight='auto'] - максимальная высота при раскрытии..\n * @property {(value: boolean, e: React.MouseEvent<HTMLButtonElement>) => void} [onExpand] - обработчик изменения состояния раскрытия.\n * @property {boolean} [fullscreenButton] - показывает кнопку полноэкранного режима.\n * @property {boolean} [fullscreen=false] - указывает, находится ли компонент в полноэкранном режиме.\n * @property {(value: boolean, e: React.MouseEvent<HTMLButtonElement>) => void} [onFullscreen] - обработчик изменения полноэкранного режима.\n * @property {React.ReactNode} leftSide - контент для отображения на левой стороне.\n * @property {React.ReactNode} [rightSide] - контент для отображения на правой стороне.\n * @property {Element | React.RefObject<HTMLElement>} [fullscreenContainer=`window.document.body`] -  контейнер для полноэкранного режима.\n * @property {number} [fullscreenZIndex=1000] - уровень z-index для полноэкранного режима.\n * @property {string} [className] - дополнительный класс.\n * @property {React.ReactNode} children - контент для отображения внутри компонента.\n */\n\nexport const Collapse = withCtx(\n  forwardRef<HTMLDivElement, CollapseProps>((props, ref) => {\n    const {\n      expandButton,\n      expanded: expandedProp = false,\n      onExpand,\n      fullscreenButton,\n      fullscreen: fullscreenProp = false,\n      onFullscreen,\n      leftSide,\n      rightSide,\n      className,\n      children,\n      fullscreenContainer = window.document.body,\n      fullscreenZIndex = 1000,\n      expandedMaxHeight = 'auto',\n      ...otherProps\n    } = props;\n\n    const refs = useMutableRef([onExpand, onFullscreen]);\n\n    const contentRef = useRef<HTMLDivElement>(null);\n\n    const [expanded, , expandedAtom] = useAtom(expandedProp);\n    const [fullscreen, , fullscreenAtom] = useAtom(fullscreenProp);\n    const [fakeContentHeight, setFakeContentHeight] = useAtom<\n      number | undefined\n    >(undefined);\n    const [expandedContentMounted, , expandedContentMountedAtom] =\n      useAtom(expanded);\n\n    const toggleExpanded = useAction(\n      (ctx, e: React.MouseEvent<HTMLButtonElement>) => {\n        const value = !ctx.get(expandedAtom);\n        refs.current[0]?.(value, e);\n        expandedAtom(ctx, value);\n        if (value) {\n          expandedContentMountedAtom(ctx, true);\n        }\n      },\n    );\n\n    const toggleFullscreen = useAction(\n      (ctx, e: React.MouseEvent<HTMLButtonElement>) => {\n        const value = !ctx.get(fullscreenAtom);\n        refs.current[1]?.(value, e);\n        fullscreenAtom(ctx, value);\n\n        setFakeContentHeight(\n          value ? contentRef.current?.clientHeight : undefined,\n        );\n      },\n    );\n\n    const afterExitExpanded = useAction((ctx) => {\n      expandedContentMountedAtom(ctx, false);\n    });\n\n    const title = isString(leftSide) ? (\n      <Text className={cnCollapse('Title')} size=\"m\" weight=\"semibold\">\n        {leftSide}\n      </Text>\n    ) : (\n      leftSide\n    );\n\n    useUpdate(expandedAtom, [expandedProp]);\n    useUpdate(fullscreenAtom, [fullscreenProp]);\n\n    return (\n      <>\n        <div {...otherProps} ref={ref} className={className}>\n          <Toolbar\n            className={cnCollapse('Toolbar')}\n            form=\"brick\"\n            border={expandedContentMounted ? 'bottom' : undefined}\n            leftSide={[\n              expandButton ? (\n                <CollapseButton\n                  active={expanded}\n                  icon={CollapseExpandIcon}\n                  onClick={toggleExpanded}\n                />\n              ) : null,\n              ...(Array.isArray(title) ? title : [title]),\n            ]}\n            rightSide={[\n              ...(Array.isArray(rightSide) ? rightSide : [rightSide]),\n              fullscreenButton ? (\n                <CollapseButton\n                  active={fullscreen}\n                  icon={CollapseFullscreenIcon}\n                  onClick={toggleFullscreen}\n                />\n              ) : null,\n            ]}\n          />\n          {children && (\n            <div\n              className={cnCollapse('Content', { expanded })}\n              style={{\n                height: fakeContentHeight,\n              }}\n            >\n              <Transition\n                in={expanded && !fullscreen}\n                unmountOnExit\n                nodeRef={contentRef}\n                timeout={animateTimeout}\n                onExited={afterExitExpanded}\n              >\n                <div\n                  className={cnCollapse('ChildrenWrapper')}\n                  ref={contentRef}\n                  style={{ maxHeight: expandedMaxHeight }}\n                >\n                  {children}\n                </div>\n              </Transition>\n            </div>\n          )}\n        </div>\n        {children && (\n          <CollapseFullscreen\n            active={fullscreen}\n            onFullscreen={toggleFullscreen}\n            container={fullscreenContainer}\n            zIndex={fullscreenZIndex}\n            leftSide={title}\n            rightSide={rightSide}\n          >\n            {children}\n          </CollapseFullscreen>\n        )}\n      </>\n    );\n  }),\n);\n"],"mappings":"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"}