{"version":3,"file":"CollapseFullscreen.js","names":["animateTimeout","cnMixPopoverAnimate","PortalWithTheme","PortalWithThemeConsumer","useTheme","getElementHeight","useAtom","React","useEffect","useMemo","useRef","Transition","Toolbar","useResizeObservedAtom","cn","CollapseButton","CollapseFullscreenIcon","cnCollapseFullscreen","isClassName","element","className","classList","contains","addClassName","add","removeClassName","remove","addCssVariable","variableName","value","document","documentElement","style","setProperty","removeCssVariable","removeProperty","getScrollBarWidth","window","innerWidth","clientWidth","bodyAddStyles","scrollBarWidth","bodyRemoveStyles","CollapseFullscreen","active","container","zIndex","rightSide","onFullscreen","children","leftSide","containerIsBody","body","current","portalRef","theme","toolbarRef","toolbarHeight","animate"],"sources":["../../../../../../src/components/Collapse/CollapseFullscreen/CollapseFullscreen.tsx"],"sourcesContent":["import './CollapseFullscreen.css';\n\nimport {\n  animateTimeout,\n  cnMixPopoverAnimate,\n} from '@consta/uikit/MixPopoverAnimate';\nimport {\n  PortalWithTheme,\n  PortalWithThemeConsumer,\n} from '@consta/uikit/PortalWithTheme';\nimport { useTheme } from '@consta/uikit/Theme';\nimport { getElementHeight } from '@consta/uikit/useResizeObserved';\nimport { useAtom } from '@reatom/npm-react';\nimport React, { useEffect, useMemo, useRef } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { Toolbar } from '##/components/Toolbar';\nimport { useResizeObservedAtom } from '##/hooks/useResizeObservedAtom';\nimport { cn } from '##/utils/bem';\n\nimport { CollapseButton } from '../CollapseButton';\nimport { CollapseFullscreenIcon } from '../CollapseFullscreenIcon';\n\ntype CollapseFullscreenProps = JSX.IntrinsicElements['div'] & {\n  active?: boolean;\n  onFullscreen?: React.MouseEventHandler<HTMLButtonElement>;\n  leftSide: React.ReactNode;\n  rightSide?: React.ReactNode;\n\n  container: Element | React.RefObject<HTMLElement>;\n  zIndex?: number;\n};\n\nconst cnCollapseFullscreen = cn('CollapseFullscreen');\n\nconst isClassName = (element: HTMLElement, className: string) => {\n  return element.classList.contains(className);\n};\n\nconst addClassName = (element: HTMLElement, className: string) => {\n  if (!isClassName(element, className)) {\n    element.classList.add(className);\n  }\n};\n\nconst removeClassName = (element: HTMLElement, className: string) => {\n  if (isClassName(element, className)) {\n    element.classList.remove(className);\n  }\n};\n\nconst addCssVariable = (variableName: string, value: string) => {\n  document.documentElement.style.setProperty(variableName, value);\n};\n\nconst removeCssVariable = (variableName: string) => {\n  document.documentElement.style.removeProperty(variableName);\n};\n\nconst getScrollBarWidth = () =>\n  window.innerWidth - document.documentElement.clientWidth;\n\nconst bodyAddStyles = () => {\n  const scrollBarWidth = getScrollBarWidth();\n\n  addCssVariable(\n    '--ct-collapse-fullscreen-body-scrollbar-width',\n    `${scrollBarWidth}px`,\n  );\n\n  addClassName(window.document.documentElement, cnCollapseFullscreen('Body'));\n};\n\nconst bodyRemoveStyles = () => {\n  removeClassName(\n    window.document.documentElement,\n    cnCollapseFullscreen('Body'),\n  );\n\n  removeCssVariable('--ct-collapse-fullscreen-body-scrollbar-width');\n};\n\nexport const CollapseFullscreen: React.FC<CollapseFullscreenProps> = ({\n  active = false,\n  container,\n  zIndex,\n  rightSide,\n  onFullscreen,\n  children,\n  leftSide,\n}) => {\n  const containerIsBody =\n    container === window.document.body ||\n    ('current' in container && container.current === window.document.body);\n\n  const portalRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n  const toolbarRef = useRef<HTMLDivElement>(null);\n  const toolbarHeight = useAtom(\n    useResizeObservedAtom(\n      useMemo(() => [toolbarRef], [toolbarRef, active]),\n      getElementHeight,\n    ),\n  )[0][0];\n\n  useEffect(() => {\n    if (active && containerIsBody) {\n      bodyAddStyles();\n    }\n  }, [active]);\n\n  useEffect(() => {\n    return bodyRemoveStyles;\n  }, []);\n\n  return (\n    <Transition\n      in={active}\n      unmountOnExit\n      nodeRef={portalRef}\n      timeout={animateTimeout}\n      onExited={bodyRemoveStyles}\n    >\n      {(animate) => (\n        <PortalWithTheme\n          ref={portalRef}\n          preset={theme}\n          container={container}\n          style={{\n            zIndex,\n            [`--collapse-toolbar-height` as string]: `${toolbarHeight}px`,\n          }}\n          className={cnCollapseFullscreen({ container: !containerIsBody }, [\n            cnMixPopoverAnimate({\n              animate,\n            }),\n          ])}\n        >\n          <PortalWithThemeConsumer ignoreClicksInsideRefs={[portalRef]}>\n            <div className={cnCollapseFullscreen('ToolbarWrapper')}>\n              <Toolbar\n                className={cnCollapseFullscreen('Toolbar')}\n                ref={toolbarRef}\n                leftSide={leftSide}\n                form=\"brick\"\n                border=\"bottom\"\n                rightSide={[\n                  rightSide,\n                  <CollapseButton\n                    active={active}\n                    icon={CollapseFullscreenIcon}\n                    onClick={onFullscreen}\n                  />,\n                ]}\n              />\n            </div>\n\n            <div className={cnCollapseFullscreen('ChildrenWrapper')}>\n              {children}\n            </div>\n          </PortalWithThemeConsumer>\n        </PortalWithTheme>\n      )}\n    </Transition>\n  );\n};\n"],"mappings":"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"}