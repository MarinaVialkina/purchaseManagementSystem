{"version":3,"file":"Pagination.js","names":["IconArrowLeft","IconArrowRight","withCtx","Button","cnMixFlex","Select","Text","useMutableRef","useAction","useAtom","useUpdate","React","forwardRef","cn","isFunction","isNumber","cnPagination","getItem","item","toString","defaultOffsetLabel","offset","step","total","from","to","guardOffset","value","Math","max","min","Pagination","props","ref","label","steps","offsetLabel","className","buttonPrevRef","buttonNextRef","onStepChange","onChange","otherProps","refs","stepValue","setStepValue","stepValueAtom","offsetValue","setOffsetValue","offsetValueAtom","onSelectChange","ctx","current","nextPageFactory","e","newValue","get","prevPageFactory","align","gap","undefined"],"sources":["../../../../../src/components/Pagination/Pagination.tsx"],"sourcesContent":["import './Pagination.css';\n\nimport { IconArrowLeft } from '@consta/icons/IconArrowLeft';\nimport { IconArrowRight } from '@consta/icons/IconArrowRight';\nimport { withCtx } from '@consta/uikit/__internal__/src/utils/state/withCtx';\nimport { PropsWithHTMLAttributesAndRef } from '@consta/uikit/__internal__/src/utils/types/PropsWithHTMLAttributes';\nimport { Button } from '@consta/uikit/Button';\nimport { cnMixFlex } from '@consta/uikit/MixFlex';\nimport { Select } from '@consta/uikit/SelectCanary';\nimport { Text } from '@consta/uikit/Text';\nimport { useMutableRef } from '@consta/uikit/useMutableRef';\nimport { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { forwardRef } from 'react';\n\nimport { cn } from '##/utils/bem';\nimport { isFunction, isNumber } from '##/utils/type-guards';\n\nexport type PaginationProps = PropsWithHTMLAttributesAndRef<\n  {\n    label?: string;\n    children?: never;\n    step?: number;\n    steps?: number[];\n    total?: number;\n    offset?: number;\n    offsetLabel?:\n      | string\n      | ((offset: number, step: number, total: number | undefined) => string);\n    onChange?: (value: number, props: { e: React.SyntheticEvent }) => void;\n    onStepChange?: (value: number, props: { e: React.SyntheticEvent }) => void;\n    buttonNextRef?: React.Ref<HTMLButtonElement>;\n    buttonPrevRef?: React.Ref<HTMLButtonElement>;\n  },\n  HTMLDivElement\n>;\n\nconst cnPagination = cn('Pagination');\n\nconst getItem = (item: number) => item.toString();\n\nconst defaultOffsetLabel = (\n  offset: number,\n  step: number,\n  total: number | undefined,\n) => {\n  const from = offset + 1;\n  const to = offset + step;\n\n  if (isNumber(total)) {\n    return `${from}-${to > total ? total : to} из ${total}`;\n  }\n  return `${from}-${to}`;\n};\n\nconst guardOffset = (value: number, total: number | undefined) => {\n  if (isNumber(total)) {\n    return Math.max(Math.min(value, total), 0);\n  }\n  return Math.max(value, 0);\n};\n\nexport const Pagination = withCtx(\n  forwardRef<HTMLDivElement, PaginationProps>((props, ref) => {\n    const {\n      label = 'Строк на странице',\n      step = 10,\n      steps = [10, 25, 50, 100],\n      total,\n      offset = 0,\n      offsetLabel = defaultOffsetLabel,\n      className,\n      buttonPrevRef,\n      buttonNextRef,\n      onStepChange,\n      onChange,\n      ...otherProps\n    } = props;\n\n    const refs = useMutableRef([onStepChange, total, onChange] as const);\n\n    const [stepValue, setStepValue, stepValueAtom] = useAtom(step);\n    const [offsetValue, setOffsetValue, offsetValueAtom] = useAtom(\n      guardOffset(offset, total),\n    );\n\n    const onSelectChange = useAction(\n      (ctx, value: number | null, props: { e: React.SyntheticEvent }) => {\n        if (isNumber(value)) {\n          stepValueAtom(ctx, value);\n          refs.current[0]?.(value, props);\n        }\n      },\n    );\n\n    const nextPageFactory = useAction((ctx, e: React.SyntheticEvent) => {\n      const newValue = guardOffset(\n        ctx.get(offsetValueAtom) + ctx.get(stepValueAtom),\n        refs.current[1],\n      );\n      offsetValueAtom(ctx, newValue);\n      refs.current[2]?.(newValue, { e });\n    });\n\n    const prevPageFactory = useAction((ctx, e: React.SyntheticEvent) => {\n      const newValue = guardOffset(\n        ctx.get(offsetValueAtom) - ctx.get(stepValueAtom),\n        refs.current[1],\n      );\n      offsetValueAtom(ctx, newValue);\n      refs.current[2]?.(newValue, { e });\n    });\n\n    useUpdate(stepValueAtom, [step]);\n    useUpdate(offsetValueAtom, [offset]);\n\n    return (\n      <div\n        ref={ref}\n        {...otherProps}\n        className={cnPagination(null, [\n          cnMixFlex({ align: 'center', gap: 'xl' }),\n          className,\n        ])}\n      >\n        <div className={cnMixFlex({ align: 'center', gap: 's' })}>\n          {label && (\n            <Text size=\"s\" view=\"secondary\">\n              {label}\n            </Text>\n          )}\n          {steps && (\n            <Select\n              className={cnPagination('Select')}\n              items={steps}\n              getItemLabel={getItem}\n              getItemKey={getItem}\n              onChange={onSelectChange}\n              value={stepValue}\n              size=\"s\"\n            />\n          )}\n        </div>\n        <div className={cnMixFlex({ align: 'center', gap: 's' })}>\n          <Text size=\"s\" className={cnPagination('OffsetLabel')}>\n            {isFunction(offsetLabel)\n              ? offsetLabel(offsetValue, stepValue, total)\n              : offsetLabel}\n          </Text>\n          <Button\n            ref={buttonPrevRef}\n            iconLeft={IconArrowLeft}\n            onlyIcon\n            view=\"clear\"\n            size=\"s\"\n            disabled={offsetValue <= 0}\n            onClick={prevPageFactory}\n          />\n          <Button\n            ref={buttonNextRef}\n            iconLeft={IconArrowRight}\n            onlyIcon\n            view=\"clear\"\n            size=\"s\"\n            onClick={nextPageFactory}\n            disabled={total ? offsetValue >= total - stepValue : undefined}\n          />\n        </div>\n      </div>\n    );\n  }),\n);\n"],"mappings":"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"}