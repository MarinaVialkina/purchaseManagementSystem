{"version":3,"file":"useResizeObservedAtom.js","names":["useAction","useUpdate","useEffect","useMemo","useCreateAtom","useSendToAtom","useResizeObservedAtom","elementsAtom","mapper","mapperAtom","stateAtom","update","ctx","get","map","el","resizeObserver","ResizeObserver","elements","disconnect","observe"],"sources":["../../../../../../src/utils/state/useResizeObservedAtom/useResizeObservedAtom.ts"],"sourcesContent":["import { AtomMut } from '@reatom/framework';\nimport { useAction, useUpdate } from '@reatom/npm-react';\nimport { useEffect, useMemo } from 'react';\n\nimport { useCreateAtom } from '##/utils/state/useCreateAtom';\nimport { useSendToAtom } from '##/utils/state/useSendToAtom';\n\nexport const useResizeObservedAtom = <\n  ELEMENT extends HTMLElement | null,\n  RETURN_TYPE,\n>(\n  elementsAtom: AtomMut<ELEMENT[]>,\n  mapper: (el: ELEMENT | null) => RETURN_TYPE,\n) => {\n  const mapperAtom = useSendToAtom([mapper]);\n  const stateAtom = useCreateAtom<(RETURN_TYPE | undefined)[]>([]);\n\n  const update = useAction((ctx) =>\n    stateAtom(\n      ctx,\n      ctx.get(elementsAtom).map((el) => ctx.get(mapperAtom)[0](el)),\n    ),\n  );\n\n  const resizeObserver = useMemo(() => new ResizeObserver(update), []);\n\n  useUpdate(\n    (ctx, elements) => {\n      update();\n      resizeObserver.disconnect();\n      for (const el of elements) {\n        el && resizeObserver.observe(el);\n      }\n    },\n    [elementsAtom],\n  );\n\n  useEffect(() => {\n    return () => {\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  return stateAtom;\n};\n"],"mappings":"qpCACA,OAASA,SAAT,CAAoBC,SAApB,KAAqC,mBAArC,CACA,OAASC,SAAT,CAAoBC,OAApB,KAAmC,OAAnC,CAEA,OAASC,aAAT,wBACA,OAASC,aAAT,wBAEA,MAAO,IAAMC,sBAAqB,CAAG,SAInCC,CAJmC,CAKnCC,CALmC,CAMhC,IACGC,EAAU,CAAGJ,aAAa,CAAC,CAACG,CAAD,CAAD,CAD7B,CAEGE,CAAS,CAAGN,aAAa,CAA8B,EAA9B,CAF5B,CAIGO,CAAM,CAAGX,SAAS,CAAC,SAACY,CAAD,QACvBF,EAAS,CACPE,CADO,CAEPA,CAAG,CAACC,GAAJ,CAAQN,CAAR,EAAsBO,GAAtB,CAA0B,SAACC,CAAD,QAAQH,EAAG,CAACC,GAAJ,CAAQJ,CAAR,EAAoB,CAApB,EAAuBM,CAAvB,CAAR,CAA1B,CAFO,CADc,CAAD,CAJrB,CAWGC,CAAc,CAAGb,OAAO,CAAC,iBAAM,IAAIc,eAAJ,CAAmBN,CAAnB,CAAN,CAAD,CAAmC,EAAnC,CAX3B,CA8BH,MAjBAV,UAAS,CACP,SAACW,CAAD,CAAMM,CAAN,CAAmB,CACjBP,CAAM,EADW,CAEjBK,CAAc,CAACG,UAAf,EAFiB,oCAGAD,CAHA,MAGjB,2BAA2B,IAAhBH,EAAgB,SACzBA,CAAE,EAAIC,CAAc,CAACI,OAAf,CAAuBL,CAAvB,CACP,CALgB,+BAMlB,CAPM,CAQP,CAACR,CAAD,CARO,CAiBT,CANAL,SAAS,CAAC,UAAM,CACd,MAAO,WAAM,CACXc,CAAc,CAACG,UAAf,EACD,CACF,CAJQ,CAIN,EAJM,CAMT,CAAOT,CACR,CArCM"}