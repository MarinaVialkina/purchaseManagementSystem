{"version":3,"file":"usePickAtom.js","names":["useAtom","useCtx","useEffect","pick","useCreateAtom","needUpdate","state","newState","keys","key","index","length","usePickAtom","target","subscribe","ctx","get","_","atom","unsubscribe","usePropAtom","spy"],"sources":["../../../../../../src/utils/state/usePickAtom/usePickAtom.ts"],"sourcesContent":["import { AtomMut } from '@reatom/framework';\nimport { useAtom, useCtx } from '@reatom/npm-react';\nimport { useEffect } from 'react';\n\nimport { pick } from '##/utils/object';\nimport { useCreateAtom } from '##/utils/state/useCreateAtom/useCreateAtom';\n\nexport type ObjectAtomValue<T> = {\n  [Property in keyof T]: T[Property];\n};\n\nexport type AtomProp<T> = AtomMut<ObjectAtomValue<T>>;\n\nconst needUpdate = (\n  state: Record<string, unknown>,\n  newState: Record<string, unknown>,\n  keys: (string | number | symbol)[],\n): boolean => {\n  for (let index = 0; index < keys.length; index++) {\n    const key = keys[index] as string;\n\n    if (newState[key] !== state[key]) {\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const usePickAtom = <\n  T extends {},\n  K extends keyof T,\n  S extends boolean = false,\n>(\n  target: AtomMut<T>,\n  keys: K[],\n  subscribe?: S,\n) => {\n  const ctx = useCtx();\n\n  // eslint-disable-next-line no-unused-vars\n  const [state, _, atom] = useAtom(\n    pick(ctx.get(target), keys),\n    undefined,\n    subscribe || false,\n  );\n\n  useEffect(() => {\n    const unsubscribe = ctx.subscribe(target, (newState) => {\n      if (needUpdate(ctx.get(atom), newState, keys)) {\n        atom(ctx, pick(newState, keys));\n      }\n    });\n\n    return unsubscribe;\n  }, [target]);\n\n  return (subscribe ? [state, atom] : atom) as S extends true\n    ? [UseObjectPropsAtomReturn<T, K>, AtomMut<UseObjectPropsAtomReturn<T, K>>]\n    : AtomMut<UseObjectPropsAtomReturn<T, K>>;\n};\n\nexport const usePropAtom = <T extends {}, K extends keyof T>(\n  target: AtomMut<T>,\n  key: K,\n) => useCreateAtom((ctx) => ctx.spy(target)[key]);\n\nexport type UseObjectPropsAtomReturn<T, K extends keyof T> = {\n  [Property in K]: T[Property];\n};\n"],"mappings":"iEACA,OAASA,OAAT,CAAkBC,MAAlB,KAAgC,mBAAhC,CACA,OAASC,SAAT,KAA0B,OAA1B,CAEA,OAASC,IAAT,oBACA,OAASC,aAAT,sCAQA,GAAMC,WAAU,CAAG,SACjBC,CADiB,CAEjBC,CAFiB,CAGjBC,CAHiB,CAIL,CACZ,IAAK,GACGC,EADH,CAAIC,CAAK,CAAG,CAAjB,CAAoBA,CAAK,CAAGF,CAAI,CAACG,MAAjC,CAAyCD,CAAK,EAA9C,CAGE,GAFMD,CAEN,CAFYD,CAAI,CAACE,CAAD,CAEhB,CAAIH,CAAQ,CAACE,CAAD,CAAR,GAAkBH,CAAK,CAACG,CAAD,CAA3B,CACE,SAGJ,QACD,CAbD,CAeA,MAAO,IAAMG,YAAW,CAAG,SAKzBC,CALyB,CAMzBL,CANyB,CAOzBM,CAPyB,CAQtB,IACGC,EAAG,CAAGd,MAAM,EADf,GAIsBD,OAAO,CAC9BG,IAAI,CAACY,CAAG,CAACC,GAAJ,CAAQH,CAAR,CAAD,CAAkBL,CAAlB,CAD0B,QAG9BM,CAAS,IAHqB,CAJ7B,uBAIIR,CAJJ,MAIWW,CAJX,MAIcC,CAJd,MAoBH,MAVAhB,UAAS,CAAC,UAAM,CACd,GAAMiB,EAAW,CAAGJ,CAAG,CAACD,SAAJ,CAAcD,CAAd,CAAsB,SAACN,CAAD,CAAc,CAClDF,UAAU,CAACU,CAAG,CAACC,GAAJ,CAAQE,CAAR,CAAD,CAAgBX,CAAhB,CAA0BC,CAA1B,CADwC,EAEpDU,CAAI,CAACH,CAAD,CAAMZ,IAAI,CAACI,CAAD,CAAWC,CAAX,CAAV,CAEP,CAJmB,CAApB,CAMA,MAAOW,EACR,CARQ,CAQN,CAACN,CAAD,CARM,CAUT,CAAQC,CAAS,CAAG,CAACR,CAAD,CAAQY,CAAR,CAAH,CAAmBA,CAGrC,CA/BM,CAiCP,MAAO,IAAME,YAAW,CAAG,SACzBP,CADyB,CAEzBJ,CAFyB,QAGtBL,cAAa,CAAC,SAACW,CAAD,QAASA,EAAG,CAACM,GAAJ,CAAQR,CAAR,EAAgBJ,CAAhB,CAAT,CAAD,CAHS,CAApB"}