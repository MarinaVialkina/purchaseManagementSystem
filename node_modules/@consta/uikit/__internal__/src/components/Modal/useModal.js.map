{"version":3,"file":"useModal.js","names":["useAction","useAtom","useUpdate","useEffect","useRef","useTheme","useForkRef","useGlobalKeys","getElementHeight","useCreateAtom","useElementAtomEventListener","useRefAtom","useResizeObservedAtom","useModal","ref","isOpen","onEsc","onOpen","onClose","ignoreOutsideClicksRefs","modalRef","portalRef","windowElAtom","windowRefCallback","contentElAtom","contentRefCallback","scrollElAtom","scrollRefCallback","modalRefForked","theme","scrollTopAtom","updateScrollTop","ctx","get","scrollTop","spy","shadowHeader","elScrollDimensionsAtom","el","scrollHeight","clientHeight","shadowFooter","heightAtom","modalHeight","contentHeight","scrollable","Escape","e","windowRef","contentRef","scrollRef"],"sources":["../../../../../src/components/Modal/useModal.ts"],"sourcesContent":["import { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { useEffect, useRef } from 'react';\n\nimport { useTheme } from '##/components/Theme';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useGlobalKeys } from '##/hooks/useGlobalKeys';\nimport { getElementHeight } from '##/hooks/useResizeObserved';\nimport { useCreateAtom } from '##/utils/state/useCreateAtom';\nimport { useElementAtomEventListener } from '##/utils/state/useElementAtomEventListener';\nimport { useRefAtom } from '##/utils/state/useRefAtom';\nimport { useResizeObservedAtom } from '##/utils/state/useResizeObservedAtom';\n\nexport const useModal = ({\n  ref,\n  isOpen,\n  onEsc,\n  onOpen,\n  onClose,\n  ignoreOutsideClicksRefs,\n}: {\n  isOpen: boolean | undefined;\n  onEsc: ((event: KeyboardEvent) => void) | undefined;\n  onOpen: (() => void) | undefined;\n  onClose: (() => void) | undefined;\n  ref: React.ForwardedRef<HTMLDivElement>;\n  ignoreOutsideClicksRefs: React.RefObject<HTMLElement>[] | undefined;\n}) => {\n  const modalRef = useRef<HTMLDivElement | null>(null);\n  const portalRef = useRef<HTMLDivElement | null>(null);\n  const [windowElAtom, windowRefCallback] = useRefAtom<HTMLDivElement>();\n  const [contentElAtom, contentRefCallback] = useRefAtom<HTMLDivElement>();\n  const [scrollElAtom, scrollRefCallback] = useRefAtom<HTMLDivElement>();\n  const modalRefForked = useForkRef([modalRef, windowRefCallback, ref]);\n\n  const { theme } = useTheme();\n\n  const scrollTopAtom = useCreateAtom<number>(0);\n  const updateScrollTop = useAction((ctx) =>\n    scrollTopAtom(ctx, ctx.get(scrollElAtom)?.scrollTop || 0),\n  );\n\n  const [shadowHeader] = useAtom<boolean>((ctx) => ctx.spy(scrollTopAtom) > 0);\n  const elScrollDimensionsAtom = useResizeObservedAtom(\n    useCreateAtom((ctx) => [ctx.spy(scrollElAtom)]),\n    (el) => [el?.scrollHeight || 0, el?.clientHeight || 0] as const,\n  );\n\n  const [shadowFooter] = useAtom<boolean>((ctx) => {\n    const scrollTop = ctx.spy(scrollTopAtom);\n    const [[scrollHeight, clientHeight] = [0, 0]] = ctx.spy(\n      elScrollDimensionsAtom,\n    );\n\n    return scrollTop < scrollHeight - clientHeight;\n  });\n\n  const heightAtom = useResizeObservedAtom(\n    useCreateAtom((ctx) => [ctx.spy(windowElAtom), ctx.spy(contentElAtom)]),\n    getElementHeight,\n  );\n\n  const [scrollable] = useAtom((ctx) => {\n    const [modalHeight = 0, contentHeight = 0] = ctx.spy(heightAtom);\n    return modalHeight < contentHeight;\n  });\n\n  useElementAtomEventListener(scrollElAtom, 'scroll', updateScrollTop);\n\n  useUpdate(updateScrollTop, [scrollElAtom]);\n\n  useEffect(() => {\n    if (isOpen) {\n      onOpen?.();\n    } else {\n      onClose?.();\n    }\n  }, [isOpen]);\n\n  useGlobalKeys({\n    Escape: (e: KeyboardEvent) => isOpen && onEsc && onEsc(e),\n  });\n\n  return {\n    shadowHeader,\n    shadowFooter,\n    scrollable,\n    theme,\n    portalRef,\n    windowRef: modalRefForked,\n    contentRef: contentRefCallback,\n    scrollRef: scrollRefCallback,\n    windowElAtom,\n    ignoreOutsideClicksRefs: [...(ignoreOutsideClicksRefs || []), modalRef],\n  };\n};\n"],"mappings":"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"}