import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["controlRef","size","getOptionActions","dropdownRef","labelForCreate","className","labelForNotFound","labelForEmptyItems","hasItemsAtom","form","openAtom","offset","renderItem","visibleItemsAtom","isLoading","getGroupLabel","notFound","itemsRefs","virtualScroll","onScrollToBottom","highlightedIndexAtom","valueAtom","getItemKeyAtom","highlightIndex","onCreate","onChange","onChangeAll","inputValueAtom","groupsCounterAtom","dropdownZIndexAtom","selectAllLabel"];import"./SelectDropdown.css";import{useAtom}from"@reatom/npm-react";import React,{Fragment,memo,useMemo}from"react";import{ListItem,ListLoader,mapVerticalSpace}from"../../ListCanary";import{isNotOptionForCreate,isOptionForCreate,isOptionForSelectAll}from"../useSelect";import{forkRef,useForkRef}from"../../../hooks/useForkRef";import{useVirtualScroll}from"../../../hooks/useVirtualScroll";import{cnMixScrollBar}from"../../../mixs/MixScrollBar";import{cnMixSpace}from"../../../mixs/MixSpace";import{cnCanary as cn}from"../../../utils/bem";import{fabricIndex}from"../../../utils/fabricIndex";import{SelectCreateButton}from"../SelectCreateButton/SelectCreateButton";import{SelectGroupLabel}from"../SelectGroupLabel/SelectGroupLabel";import{SelectItemAll}from"../SelectItemAll/SelectItemAll";import{SelectLoader}from"../SelectLoader/SelectLoader";import{SelectPopover}from"../SelectPopover";import{SelectRenderItem}from"../SelectRenderItem";export var selectDropdownForm=["default","brick","round"];export var defaultSelectDropdownPropForm=selectDropdownForm[0];var cnSelectDropdown=cn("SelectDropdown"),getLengthElements=function(a){for(var b=1>=a.length?0:a.length,c=0;c<a.length;c++){var d,e=a[c];isNotOptionForCreate(e)&&null!==e&&void 0!==e&&null!==(d=e.items)&&void 0!==d&&d.length&&(b+=e.items.length)}return b},isVisible=function(a,b){return b>=a[0]&&b<a[1]};export var SelectDropdown=memo(function(a){var b=a.controlRef,c=a.size,d=a.getOptionActions,e=a.dropdownRef,f=a.labelForCreate,g=a.className,h=a.labelForNotFound,i=a.labelForEmptyItems,j=a.hasItemsAtom,k=a.form,l=a.openAtom,m=a.offset,n=void 0===m?"none":m,o=a.renderItem,p=a.visibleItemsAtom,q=a.isLoading,r=a.getGroupLabel,s=a.notFound,t=a.itemsRefs,u=a.virtualScroll,v=a.onScrollToBottom,w=a.highlightedIndexAtom,x=a.valueAtom,y=a.getItemKeyAtom,z=a.highlightIndex,A=a.onCreate,B=a.onChange,C=a.onChangeAll,D=a.inputValueAtom,E=a.groupsCounterAtom,F=a.dropdownZIndexAtom,G=a.selectAllLabel,H=_objectWithoutProperties(a,_excluded),I=useAtom(p),J=_slicedToArray(I,1),K=J[0],L=useAtom(j),M=_slicedToArray(L,1),N=M[0],O=useAtom(!1),P=_slicedToArray(O,2),Q=P[0],R=P[1],S=useAtom(y),T=_slicedToArray(S,1),U=T[0],V="round"===k?"increased":"normal",W=useMemo(function(){return 0<K.filter(function(a){return isOptionForCreate(a)||Array.isArray(a.items)&&0<a.items.length}).length},[K]),X="none"===n?void 0:n,Y=useMemo(function(){return getLengthElements(K)},[K]),Z=useVirtualScroll({length:Y,isActive:u&&Q,onScrollToBottom:v}),$=Z.spaceTop,_=Z.slice,aa=Z.listRefs,ba=Z.scrollElementRef,ca=useForkRef([ba,e]),da=0===_[0]&&u?[0,50]:_,ea=fabricIndex(),fa=fabricIndex(),ga=useAtom(F),ha=_slicedToArray(ga,1),ia=ha[0];return React.createElement(SelectPopover,Object.assign({},H,{anchorRef:b,offset:X,role:"listbox",className:cnSelectDropdown(),size:c,controlRef:b,openAtom:l,form:k,onMount:R,style:{zIndex:ia}}),Q&&React.createElement("div",{className:cnSelectDropdown("ScrollContainer",[cnMixSpace({pV:mapVerticalSpace[c]}),cnMixScrollBar({size:"xs"})]),ref:ca},q&&!W&&React.createElement(SelectLoader,null),React.createElement("div",{className:cnSelectDropdown("List"),key:cnSelectDropdown("List"),style:{marginTop:$}},K.map(function(a){if(isOptionForCreate(a)){var e=ea();return React.createElement(SelectCreateButton,{size:c,key:cnSelectDropdown("List",{key:"CreateButton"}),labelForCreate:f,indent:V,ref:t[e],onClick:A,highlightedIndexAtom:w,inputValueAtom:D,highlightIndex:z,index:e})}var b=1<K.length?fa():0;return React.createElement(Fragment,{key:a.key},a.group&&r&&isVisible(da,b)&&React.createElement(SelectGroupLabel,{label:r(a.group),size:c,indent:V,ref:aa[b],key:"group-".concat(a.key,"-Label")}),a.items.map(function(b){if(isOptionForSelectAll(b)){var e=fa(),f=ea();if(isVisible(da,e))return React.createElement(SelectItemAll,Object.assign({label:G,groupId:a.key,highlightedIndexAtom:w,groupsCounterAtom:E,key:cnSelectDropdown("SelectItemAll",{group:a.key}),ref:forkRef([aa[e],t[f]]),indent:V,size:c},d({index:f,item:b}),{index:f}))}else{var g=fa(),h=ea();if(isVisible(da,g))return React.createElement(SelectRenderItem,Object.assign({key:cnSelectDropdown("SelectRenderItem",{group:a.key,item:U(b)}),getItemKeyAtom:y,highlightedIndexAtom:w,rootRef:forkRef([aa[g],t[h]]),renderItem:o,item:b},d({index:h,item:b}),{index:h,valueAtom:x}))}}))}),q&&W&&React.createElement(ListLoader,{size:c,innerOffset:V})),!q&&!N&&i&&React.createElement(ListItem,{size:c,label:i,innerOffset:V},i)))});
//# sourceMappingURL=SelectDropdown.js.map