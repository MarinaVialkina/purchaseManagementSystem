import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){throw a}),f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){h=!0,f=a}),f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}import{useAction,useAtom,useUpdate}from"@reatom/npm-react";import{useRef}from"react";import{useClickOutside}from"../../../hooks/useClickOutside";import{useDebounce}from"../../../hooks/useDebounce";import{useKeysRef}from"../../../hooks/useKeysRef";import{useRefs}from"../../../hooks/useRefs";import{getGroups}from"../../../utils/getGroups";import{useCreateAtom}from"../../../utils/state/useCreateAtom";import{usePickAtom,usePropAtom}from"../../../utils/state/usePickAtom";import{scrollToIndex}from"./helpers";var isMultipleParams=function(a){return!!a.multiple};export var isOptionForCreate=function(a){return a&&Object.prototype.hasOwnProperty.call(a,"__optionForCreate")};export var isNotOptionForCreate=function(a){return a&&!Object.prototype.hasOwnProperty.call(a,"__optionForCreate")};export var isOptionForSelectAll=function(a){return a&&Object.prototype.hasOwnProperty.call(a,"__optionSelectAll")};export function getCountedGroups(a,b){var c=_toConsumableArray(a);return b&&a.forEach(function(a,b){c[b].items=[{__optionSelectAll:!0,groupKey:a.key}].concat(_toConsumableArray(c[b].items))}),c}export var useSelect=function(a){var b=a.propsAtom,c=useRef(null),d=useRef(null),e=useRef(null),f=usePropAtom(b,"items"),g=usePropAtom(b,"selectAll"),h=usePropAtom(b,"value"),i=usePropAtom(b,"disabled"),j=usePropAtom(b,"inputValue"),k=usePropAtom(b,"dropdownOpen"),l=useCreateAtom(function(a){var c,d=null===(c=a.spy(b).style)||void 0===c?void 0:c.zIndex;return"number"==typeof d?d+1:void 0}),m=usePropAtom(b,"ignoreOutsideClicksRefs"),n=usePropAtom(b,"onCreate"),o=usePropAtom(b,"getItemKey"),p=useAtom(m),q=_slicedToArray(p,1),r=q[0],s=useCreateAtom(function(a){var b=a.spy(h);return b&&(Array.isArray(b)?b:[b])||[]}),t=useCreateAtom(!1),u=useCreateAtom(!1),v=useCreateAtom(0),w=useCreateAtom(""),x=useCreateAtom(function(a){var c=a.spy(b),d=c.clearButton,e=a.spy(w),f=a.spy(s);return!!(d&&(null!==f&&void 0!==f&&f.length||e))}),y=useAction(function(a){var d,e,f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";null===(d=(e=a.get(b)).onInput)||void 0===d?void 0:d.call(e,f),w(a,f),c.current&&(c.current.value=f)}),z=useDebounce(useAction(function(){var a;null===(a=c.current)||void 0===a?void 0:a.focus()}),10),A=useCreateAtom(function(a){var b=a.spy(n);if(b){var c=a.spy(w);return{label:c,__optionForCreate:!0}}}),B=usePickAtom(b,["selectAll","groups","getItemGroupKey","getGroupKey","getItemDisabled","getItemKey","items"]),C=useCreateAtom(function(a){var b=a.spy(B),c=b.selectAll,d=b.groups,e=b.getItemGroupKey,f=b.getGroupKey,g=b.items,h=a.spy(A),i=getCountedGroups(getGroups(g,null!==d&&void 0!==d&&d.length?e:void 0,d,f,void 0),!!c);return h?[h].concat(_toConsumableArray(i)):i}),D=useCreateAtom(function(a){var b=a.spy(C),c=a.spy(g),d=a.spy(s),e=a.get(B),f=e.getItemDisabled,h={};return c&&function getSelectedCounter(){var a,c=_createForOfIteratorHelper(b);try{for(c.s();!(a=c.n()).done;){var j=a.value;if(!isOptionForCreate(j)){h[j.key]=[0,j.items.length-1];var e,g=_createForOfIteratorHelper(j.items);try{var i=function(){var a=e.value;isOptionForSelectAll(a)||f(a)||!d.some(function(b){return b===a})||(h[j.key][0]=(h[j.key][0]||0)+1)};for(g.s();!(e=g.n()).done;)i()}catch(a){g.e(a)}finally{g.f()}}}}catch(a){c.e(a)}finally{c.f()}}(),h}),E=useAtom(function(a){var b=a.spy(f),c=a.spy(A),d=a.spy(g),e=a.spy(C);return b.length+(c?1:0)+(d?e.length:0)}),F=_slicedToArray(E,3),G=F[0],H=F[1],I=F[2],J=useCreateAtom(function(a){var b=a.spy(f),c=a.spy(A);return!!c||!!b.length}),K=useRefs(G,void 0),L=useAction(function(a){var b=a.get(f),c=a.get(v),e=d.current;0<b.length&&e&&scrollToIndex(c,e,K)}),M=useAction(function(a,b){var c=a.get(I);v(a,function(a){var d=Math.min(Math.max(0,"function"==typeof b?b(a):b),c-1);return d})}),N=useAction(function(a,c,d){c.stopPropagation();var e=a.get(b);if(isMultipleParams(e)){var f=e.getItemDisabled,g=e.getItemKey,h=e.onChange,i=a.get(s).filter(function(a){return!!(null!==f&&void 0!==f&&f(a))||g(a)!==g(d)});h(null!==i&&void 0!==i&&i.length?i:null,{e:c})}}),O=useAction(function(a,c,d){var e=a.get(b),f=e.getItemDisabled,g=e.getItemKey,h=e.onChange,i=e.multiple,j=e.disabled;if(!(j||f&&f(d)))if(i){var k=a.get(s),l=k.some(function(a){return g(a)===g(d)})?k.filter(function(a){return g(a)!==g(d)}):[].concat(_toConsumableArray(k),[d]),m=null!==l&&void 0!==l&&l.length?l:null;h(m,{e:c})}else h(d,{e:c}),y(""),u(a,!1)}),P=useAction(function(a,c,d){var e=a.get(b),f=a.get(s),g=e.getItemDisabled,h=e.getItemKey,i=e.multiple,j=e.onChange;if(i){var k=g?d.filter(function(a){return!g(a)}):d,l=[],m=[];if(f.forEach(function(a){k.find(function(b){return h(a)===h(b)})?l.push(a):m.push(a)}),l.length===k.length)j(m,{e:c});else{var n=[].concat(m,_toConsumableArray(k));j(n,{e:c})}}}),Q=useAction(function(a,c){var d=a.get(b),e=d.onCreate;null===e||void 0===e?void 0:e(a.get(w),{e:c}),u(a,!1),y("")}),R=useAction(function(a,c){!a.get(i)&&a.get(b).input&&(null===y||void 0===y?void 0:y(c.target.value),u(a,!0))}),S=useAction(function(a){a.get(i)||u(a,function(a){return!a}),z()}),T=useAction(function(a,c){var d=a.get(b),e=d.getItemDisabled,f=d.multiple,g=d.onChange,h=d.disabled;if(!h){var i=a.get(s);if(f){var j=null===i||void 0===i?void 0:i.filter(function(a){return null===e||void 0===e?void 0:e(a)}),k=j&&0<j.length?j:null;g(k,{e:c})}else g(null,{e:c});y("")}}),U=useAction(function(a,b){return function(a){return N(a,b)}}),V=useAction(function(a,b){b.preventDefault(),b.stopPropagation(),a.get(i)||(u(a,!0),M(function(a){return a-1}),L())}),W=useAction(function(a,b){b.preventDefault(),b.stopPropagation(),a.get(i)||(u(a,!0),M(function(a){return a+1}),L())}),X=useAction(function(a,c){var d=a.get(b),e=d.items,f=a.get(v),g=a.get(w),h=a.get(C),i=a.get(u);if(i){(g||e[f])&&(c.preventDefault(),c.stopPropagation());var j=function(a){var b,c=0,d=_createForOfIteratorHelper(h);try{for(d.s();!(b=d.n()).done;){var e=b.value;if(isOptionForCreate(e)){if(c===a)return[void 0,e];c++;continue}if(e.items.length+c>a)return[e,e.items[a-c]];c+=e.items.length}}catch(a){d.e(a)}finally{d.f()}return[void 0,void 0]},k=j(f),l=_slicedToArray(k,2),m=l[0],n=l[1];if(isOptionForCreate(n))return void Q(c);if(isOptionForSelectAll(n)){var o;return void P(c,null!==(o=null===m||void 0===m?void 0:m.items.filter(function(a){return!isOptionForSelectAll(a)}))&&void 0!==o?o:[])}n&&O(c,n)}else u(a,!0)}),Y=useAction(function(a,b){b.preventDefault(),b.stopPropagation(),u(a,!1)}),Z=useAction(function(a,b){a.get(u)&&(b.preventDefault(),b.stopPropagation(),u(a,!1))}),$=useAction(function(a,c){var d=a.get(w),e=a.get(b),f=e.multiple,g=e.clearButton,h=a.get(s);d||(f?N(c,h[h.length-1]):g&&(null===T||void 0===T?void 0:T(c)))}),_=useAtom({ArrowUp:V,ArrowDown:W,PageUp:V,PageDown:W,Home:V,End:W,Enter:X,Escape:Y,Tab:Z,Backspace:$}),aa=_slicedToArray(_,1),ba=aa[0],ca=useAction(function(a,b){var c=b.index,d=b.item,e=a.get(C);if(isOptionForCreate(d))return{onClick:Q,onMouseEnter:function onMouseEnter(){return M(c)}};if(isOptionForSelectAll(d)){var f=function(){var a,b=_createForOfIteratorHelper(e);try{for(b.s();!(a=b.n()).done;){var f=a.value;if(!isOptionForCreate(f)&&f.key===d.groupKey){var c;return null!==(c=null===f||void 0===f?void 0:f.items.filter(function(a){return!isOptionForSelectAll(a)}))&&void 0!==c?c:[]}}}catch(a){b.e(a)}finally{b.f()}return[]};return{onClick:function onClick(a){return P(a,f())},onMouseEnter:function onMouseEnter(){return M(c)}}}return{onClick:function onClick(a){return O(a,d)},onMouseEnter:function onMouseEnter(){return M(c)}}}),da=useAction(function(a,c){var d=a.get(b),e=d.disabled,f=d.onFocus,g=a.get(t);e||(!g&&t(a,!0),"function"==typeof f&&f(c))}),ea=useAction(function(a,c){var d=a.get(b),e=d.onBlur;return a.get(u)?void z():void(a.get(t)&&t(a,!1),"function"==typeof e&&e(c))}),fa=useAction(function(a){var b=a.get(i);if(a.get(u))u(a,!1),t(a,!1);else if(!b){var d;u(a,!0),t(a,!0),null===(d=c.current)||void 0===d?void 0:d.focus()}});return useKeysRef({keys:ba,ref:c,isActive:useAction(function(a){return!a.get(i)})}),useClickOutside({isActive:!0,ignoreClicksInsideRefs:[d,e].concat(_toConsumableArray(r||[])),handler:useAction(function(a){u(a,!1),t(a,!1)})}),useUpdate(function(a,b){return b&&u(a,!1)},[i]),useUpdate(function(a){var c,d,e=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];null===(c=(d=a.get(b)).onDropdownOpen)||void 0===c?void 0:c.call(d,e),M(0)},[u]),useUpdate(function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",c=a.get(w);b!==c&&y(b)},[j]),useUpdate(function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return u(a,b)},[k]),{openAtom:u,focusAtom:t,inputValueAtom:w,clearButtonAtom:x,onInput:y,getOptionActions:ca,handleInputBlur:ea,handleToggleDropdown:fa,getHandleRemoveValue:U,inputRef:c,dropdownRef:d,controlRef:e,handleInputChange:R,handleInputClick:S,handleInputFocus:da,visibleItemsAtom:C,clearValue:T,optionsRefs:K,highlightedIndexAtom:v,valueAtom:s,getItemKeyAtom:o,onChangeAll:P,highlightIndex:M,onCreate:Q,onChange:O,hasItemsAtom:J,groupsCounterAtom:D,dropdownZIndexAtom:l}};
//# sourceMappingURL=useSelect.js.map