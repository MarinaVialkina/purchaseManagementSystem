import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["size","getOptionActions","listRef","labelForCreate","className","labelForNotFound","labelForEmptyItems","hasItemsAtom","form","openAtom","renderItem","visibleItemsAtom","isLoading","getGroupLabel","notFound","itemsRefs","virtualScroll","onScrollToBottom","highlightedIndexAtom","valueAtom","getItemKeyAtom","onChange","onChangeAll","inputValueAtom","groupsCounterAtom","dropdownZIndexAtom","selectAllLabel","view","disabledAtom"];import"./FlatSelectList.css";import{useAtom}from"@reatom/npm-react";import React,{Fragment,memo,useMemo}from"react";import{ListBox,ListItem,ListLoader}from"../../ListCanary";import{forkRef,useForkRef}from"../../../hooks/useForkRef";import{useVirtualScroll}from"../../../hooks/useVirtualScroll";import{cn}from"../../../utils/bem";import{fabricIndex}from"../../../utils/fabricIndex";import{FlatSelectCreateButton}from"../FlatSelectCreateButton";import{FlatSelectGroupLabel}from"../FlatSelectGroupLabel/FlatSelectGroupLabel";import{FlatSelectItemAll}from"../FlatSelectItemAll/FlatSelectItemAll";import{FlatSelectLoader}from"../FlatSelectLoader/FlatSelectLoader";import{FlatSelectRenderItem}from"../FlatSelectRenderItem";import{isNotOptionForCreate,isOptionForCreate,isOptionForSelectAll}from"../useFlatSelect";export var FlatSelectListForm=["default","brick","round"];export var defaultFlatSelectListPropForm=FlatSelectListForm[0];var cnFlatSelectList=cn("FlatSelectList"),getLengthElements=function(a){for(var b=1>=a.length?0:a.length,c=0;c<a.length;c++){var d,e=a[c];isNotOptionForCreate(e)&&null!==e&&void 0!==e&&null!==(d=e.items)&&void 0!==d&&d.length&&(b+=e.items.length)}return b},isVisible=function(a,b){return b>=a[0]&&b<a[1]};export var FlatSelectList=memo(function(a){var b=a.size,c=a.getOptionActions,d=a.listRef,e=a.labelForCreate,f=a.className,g=a.labelForNotFound,h=a.labelForEmptyItems,i=a.hasItemsAtom,j=a.form,k=a.openAtom,l=a.renderItem,m=a.visibleItemsAtom,n=a.isLoading,o=a.getGroupLabel,p=a.notFound,q=a.itemsRefs,r=a.virtualScroll,s=a.onScrollToBottom,t=a.highlightedIndexAtom,u=a.valueAtom,v=a.getItemKeyAtom,w=a.onChange,x=a.onChangeAll,y=a.inputValueAtom,z=a.groupsCounterAtom,A=a.dropdownZIndexAtom,B=a.selectAllLabel,C=a.view,D=a.disabledAtom,E=_objectWithoutProperties(a,_excluded),F=useAtom(m),G=_slicedToArray(F,1),H=G[0],I=useAtom(i),J=_slicedToArray(I,1),K=J[0],L=useAtom(v),M=_slicedToArray(L,1),N=M[0],O="round"===j?"increased":"normal",P=useMemo(function(){return 0<H.filter(function(a){return isOptionForCreate(a)||Array.isArray(a.items)&&0<a.items.length}).length},[H]),Q=useMemo(function(){return getLengthElements(H)},[H]),R=useVirtualScroll({length:Q,isActive:r,onScrollToBottom:s}),S=R.spaceTop,T=R.slice,U=R.listRefs,V=R.scrollElementRef,W=useForkRef([V,d]),X=0===T[0]&&r?[0,50]:T,Y=fabricIndex(),Z=fabricIndex();return React.createElement(ListBox,Object.assign({},E,{size:b,ref:W,className:cnFlatSelectList({view:C},[f]),tabIndex:-1}),n&&!P&&React.createElement(FlatSelectLoader,null),React.createElement("div",{className:cnFlatSelectList("List"),key:cnFlatSelectList("List"),style:{marginTop:S}},H.map(function(a){if(isOptionForCreate(a)){var f=Y();return React.createElement(FlatSelectCreateButton,Object.assign({size:b,key:cnFlatSelectList("List",{key:"CreateButton"}),labelForCreate:e,indent:O,ref:q[f],highlightedIndexAtom:t,inputValueAtom:y,disabledAtom:D,index:f},c({index:f,item:a})))}var d=1<H.length?Z():0;return React.createElement(Fragment,{key:a.key},a.group&&o&&isVisible(X,d)&&React.createElement(FlatSelectGroupLabel,{label:o(a.group),size:b,indent:O,ref:U[d],key:"group-".concat(a.key,"-Label")}),a.items.map(function(d){if(isOptionForSelectAll(d)){var e=Z(),f=Y();if(isVisible(X,e))return React.createElement(FlatSelectItemAll,Object.assign({label:B,groupId:a.key,highlightedIndexAtom:t,groupsCounterAtom:z,key:cnFlatSelectList("SelectItemAll",{group:a.key}),ref:forkRef([U[e],q[f]]),indent:O,size:b},c({index:f,item:d}),{index:f,disabledAtom:D}))}else{var g=Z(),h=Y();if(isVisible(X,g))return React.createElement(FlatSelectRenderItem,Object.assign({key:cnFlatSelectList("SelectRenderItem",{group:a.key,item:N(d)}),getItemKeyAtom:v,highlightedIndexAtom:t,rootRef:forkRef([U[g],q[h]]),renderItem:l,item:d},c({index:h,item:d}),{index:h,valueAtom:u}))}}))}),n&&P&&React.createElement(ListLoader,{size:b,innerOffset:O})),!n&&!K&&h&&React.createElement(ListItem,{size:b,label:h,innerOffset:O},h))});
//# sourceMappingURL=FlatSelectList.js.map