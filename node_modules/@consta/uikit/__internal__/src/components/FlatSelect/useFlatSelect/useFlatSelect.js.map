{"version":3,"file":"useFlatSelect.js","names":["action","sleep","withConcurrency","useAction","useAtom","useUpdate","useRef","useRefs","animateTimeout","getGroups","useClickOutsideAtom","useCreateAtom","useElementAtomEventListener","useKeysAtom","usePickAtom","usePropAtom","useRefAtom","scrollToIndex","isMultipleParams","params","multiple","isOptionForCreate","Object","prototype","hasOwnProperty","call","isNotOptionForCreate","isOptionForSelectAll","getCountedGroups","groups","selectAll","copyGroups","forEach","group","index","items","__optionSelectAll","groupKey","key","useFlatSelect","propsAtom","inputRef","listRef","anchorRefAtom","anchorElementAtom","ctx","ref","spy","current","rootElementAtom","rootRef","rootFocusAtom","rootMouseDownAtom","itemsAtom","selectAllAtom","valuePropAtom","disabledPropAtom","disabledAtom","inputValuePropAtom","openPropAtom","withOnCreateAtom","onCreate","dropdownZIndexAtom","zIndex","style","ignoreOutsideClicksRefsAtom","getItemKeyAtom","valueAtom","value","Array","isArray","inputFocusAtom","openAtom","highlightedIndexAtom","inputValueAtom","clearButtonAtom","clearButton","inputValue","length","setRootFocus","schedule","pipe","handleRootMouseDown","handleRootMouseUp","handleRootFocus","handleRootBlur","onInput","get","optionForCreateAtom","withOnCreate","label","__optionForCreate","propsForVisibleItemsAtom","visibleItemsAtom","getItemGroupKey","getGroupKey","optionForCreate","resultGroups","groupsCounterAtom","visibleItems","getItemDisabled","groupCounter","getFlatSelectedCounter","groupItems","some","item","maxHighlightIndex","_","maxHighlightIndexAtom","hasItemsAtom","optionsRefs","scrollToHighlightedIndex","highlightedIndex","listElement","highlightIndex","indexForHighlight","state","newIndex","Math","min","max","removeValue","e","valueItem","stopPropagation","props","getItemKey","onChange","newValue","filter","disabled","val","onChangeAll","nonDisabledItems","currentGroupValues","withoutGroupValues","el","find","push","handleInputChange","input","target","clearValue","getHandleRemoveValue","ArrowUp","preventDefault","old","ArrowDown","Enter","getData","counter","Escape","focus","Tab","keysAtom","PageUp","PageDown","Home","End","getOptionActions","onClick","onMouseEnter","getItems","console","log","handleInputFocus","onInputFocus","focused","handleInputBlur","onInputBlur","isActiveAtom","ignoreClicksElementsAtom","rootElement","anchorElement","ignoreOutsideClicksElements","map","handler","inputValueProp","openProp","handleAnchorClick","elAtom","open","onOpen"],"sources":["../../../../../../src/components/FlatSelect/useFlatSelect/useFlatSelect.tsx"],"sourcesContent":["import { action, AtomMut, sleep, withConcurrency } from '@reatom/framework';\nimport { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { useRef } from 'react';\n\nimport { useRefs } from '##/hooks/useRefs';\nimport { animateTimeout } from '##/mixs/MixPopoverAnimate';\nimport { getGroups, GetGroupsResult } from '##/utils/getGroups';\nimport { useClickOutsideAtom } from '##/utils/state/useClickOutsideAtom';\nimport { useCreateAtom } from '##/utils/state/useCreateAtom';\nimport { useElementAtomEventListener } from '##/utils/state/useElementAtomEventListener';\nimport { KeyHandlers, useKeysAtom } from '##/utils/state/useKeysAtom';\nimport { usePickAtom, usePropAtom } from '##/utils/state/usePickAtom';\nimport { useRefAtom } from '##/utils/state/useRefAtom';\n\nimport { PropsWithDefault } from '../defaultProps';\nimport {\n  CountedGroup,\n  FlatSelectAllItem,\n  FlatSelectGroupDefault,\n  FlatSelectItemDefault,\n  FlatSelectPropOnChange,\n  Group,\n} from '../types';\nimport { scrollToIndex } from './helpers';\n\ntype IndexForHighlight = number | ((oldIndex: number) => number);\n\nexport type OptionForCreate = {\n  label: string;\n  __optionForCreate: boolean;\n};\n\nexport type UseFlatSelectProps<\n  ITEM = FlatSelectItemDefault,\n  GROUP = FlatSelectGroupDefault,\n  MULTIPLE extends boolean = false,\n> = {\n  propsAtom: AtomMut<PropsWithDefault<ITEM, GROUP, MULTIPLE>>;\n};\n\nexport type OptionProps<ITEM> = {\n  index: number;\n  item: ITEM | OptionForCreate | FlatSelectAllItem;\n};\n\nexport type GetOptionPropsResult = {\n  onClick: (e: React.MouseEvent) => void;\n  onMouseEnter: (e: React.MouseEvent) => void;\n};\n\nconst isMultipleParams = <\n  ITEM = FlatSelectItemDefault,\n  GROUP = FlatSelectGroupDefault,\n>(\n  params: PropsWithDefault<ITEM, GROUP, boolean>,\n): params is PropsWithDefault<ITEM, GROUP, true> => {\n  return !!params.multiple;\n};\n\nexport const isOptionForCreate = <ITEM, GROUP>(\n  params: OptionForCreate | Group<ITEM, GROUP> | ITEM,\n): params is OptionForCreate => {\n  return (\n    params && Object.prototype.hasOwnProperty.call(params, '__optionForCreate')\n  );\n};\n\nexport const isNotOptionForCreate = <ITEM, GROUP>(\n  params: OptionForCreate | Group<ITEM, GROUP>,\n): params is Group<ITEM, GROUP> => {\n  return (\n    params && !Object.prototype.hasOwnProperty.call(params, '__optionForCreate')\n  );\n};\n\nexport const isOptionForSelectAll = <ITEM,>(\n  params: FlatSelectAllItem | ITEM,\n): params is FlatSelectAllItem => {\n  return (\n    params && Object.prototype.hasOwnProperty.call(params, '__optionSelectAll')\n  );\n};\n\nexport function getCountedGroups<ITEM, GROUP>(\n  groups: GetGroupsResult<ITEM, GROUP>,\n  selectAll: boolean,\n): CountedGroup<ITEM, GROUP>[] {\n  const copyGroups: CountedGroup<ITEM, GROUP>[] = [...groups];\n\n  if (selectAll) {\n    groups.forEach((group, index) => {\n      copyGroups[index].items = [\n        {\n          __optionSelectAll: true,\n          groupKey: group.key,\n        },\n        ...copyGroups[index].items,\n      ];\n    });\n  }\n  return copyGroups;\n}\n\nexport const useFlatSelect = <\n  ITEM = FlatSelectItemDefault,\n  GROUP = FlatSelectItemDefault,\n  MULTIPLE extends boolean = false,\n>({\n  propsAtom,\n}: UseFlatSelectProps<ITEM, GROUP, MULTIPLE>) => {\n  const inputRef = useRef<HTMLInputElement>(null);\n  const listRef = useRef<HTMLDivElement>(null);\n\n  const anchorRefAtom = usePropAtom(propsAtom, 'anchorRef');\n  const anchorElementAtom = useCreateAtom((ctx) => {\n    const ref = ctx.spy(anchorRefAtom);\n    return ref?.current ? ref.current : null;\n  });\n\n  const [rootElementAtom, rootRef] = useRefAtom<HTMLDivElement>();\n\n  const rootFocusAtom = useCreateAtom(false);\n\n  const rootMouseDownAtom = useCreateAtom(false);\n\n  const itemsAtom = usePropAtom(propsAtom, 'items');\n  const selectAllAtom = usePropAtom(propsAtom, 'selectAll');\n  const valuePropAtom = usePropAtom(propsAtom, 'value');\n  const disabledPropAtom = usePropAtom(propsAtom, 'disabled');\n  const disabledAtom = useCreateAtom((ctx) => !!ctx.spy(disabledPropAtom));\n  const inputValuePropAtom = usePropAtom(propsAtom, 'inputValue');\n  const openPropAtom = usePropAtom(propsAtom, 'isOpen');\n  const withOnCreateAtom = useCreateAtom(\n    (ctx) => !!ctx.spy(propsAtom).onCreate,\n  );\n\n  const dropdownZIndexAtom = useCreateAtom((ctx) => {\n    const zIndex = ctx.spy(propsAtom).style?.zIndex;\n    return typeof zIndex === 'number' ? zIndex + 1 : undefined;\n  });\n  const ignoreOutsideClicksRefsAtom = usePropAtom(\n    propsAtom,\n    'ignoreOutsideClicksRefs',\n  );\n\n  const getItemKeyAtom = usePropAtom(propsAtom, 'getItemKey');\n\n  const valueAtom = useCreateAtom((ctx) => {\n    const value = ctx.spy(valuePropAtom);\n    return (value && (Array.isArray(value) ? value : [value])) || [];\n  }) as unknown as AtomMut<ITEM[]>;\n  const inputFocusAtom = useCreateAtom(false);\n  const openAtom = useCreateAtom(false);\n  const highlightedIndexAtom = useCreateAtom(-1);\n  const inputValueAtom = useCreateAtom('');\n\n  const clearButtonAtom = useCreateAtom((ctx) => {\n    const { clearButton } = ctx.spy(propsAtom);\n    const inputValue = ctx.spy(inputValueAtom);\n    const value = ctx.spy(valueAtom);\n    return !!(clearButton && (value?.length || inputValue));\n  });\n\n  const setRootFocus = useAction(\n    action(async (ctx, value: boolean) => {\n      await ctx.schedule(() => sleep(5));\n      rootFocusAtom(ctx, value);\n    }).pipe(withConcurrency()),\n  );\n  const handleRootMouseDown = useAction((ctx) => rootMouseDownAtom(ctx, true));\n  const handleRootMouseUp = useAction((ctx) => rootMouseDownAtom(ctx, false));\n  const handleRootFocus = useAction(() => setRootFocus(true));\n  const handleRootBlur = useAction(() => setRootFocus(false));\n  const onInput = useAction((ctx, value: string | undefined = '') => {\n    ctx.get(propsAtom).onInput?.(value);\n    inputValueAtom(ctx, value);\n\n    if (inputRef.current) {\n      inputRef.current.value = value;\n    }\n  });\n\n  const optionForCreateAtom = useCreateAtom<OptionForCreate | undefined>(\n    (ctx) => {\n      const withOnCreate = ctx.spy(withOnCreateAtom);\n      if (!withOnCreate) {\n        return undefined;\n      }\n      const inputValue = ctx.spy(inputValueAtom);\n      const optionForCreate: OptionForCreate = {\n        label: inputValue,\n        __optionForCreate: true,\n      };\n      return optionForCreate;\n    },\n  );\n\n  const propsForVisibleItemsAtom = usePickAtom(\n    propsAtom as AtomMut<PropsWithDefault<ITEM, GROUP, boolean>>,\n    [\n      'selectAll',\n      'groups',\n      'getItemGroupKey',\n      'getGroupKey',\n      'getItemKey',\n      'items',\n    ],\n  );\n\n  const visibleItemsAtom = useCreateAtom((ctx) => {\n    const { selectAll, groups, getItemGroupKey, getGroupKey, items } = ctx.spy(\n      propsForVisibleItemsAtom,\n    );\n\n    const optionForCreate = ctx.spy(optionForCreateAtom);\n\n    const resultGroups = getCountedGroups(\n      getGroups(\n        items,\n        groups?.length ? getItemGroupKey : undefined,\n        groups,\n        getGroupKey,\n        undefined,\n      ),\n      !!selectAll && items.length ? selectAll : false,\n    );\n\n    return optionForCreate ? [optionForCreate, ...resultGroups] : resultGroups;\n  });\n\n  const groupsCounterAtom = useCreateAtom((ctx) => {\n    const visibleItems = ctx.spy(visibleItemsAtom);\n    const selectAll = ctx.spy(selectAllAtom);\n    const value = ctx.spy(valueAtom);\n    const { getItemDisabled } = ctx.get(propsAtom);\n\n    const groupCounter: Record<string, [number, number]> = {};\n\n    const getFlatSelectedCounter = () => {\n      for (const group of visibleItems) {\n        if (isOptionForCreate(group)) {\n          continue;\n        }\n        groupCounter[group.key] = [0, group.items.length - 1];\n        for (const groupItems of group.items) {\n          if (\n            !isOptionForSelectAll(groupItems) &&\n            !getItemDisabled(groupItems) &&\n            value.some((item) => item === groupItems)\n          ) {\n            groupCounter[group.key][0] = (groupCounter[group.key][0] || 0) + 1;\n          }\n        }\n      }\n    };\n\n    if (selectAll) {\n      getFlatSelectedCounter();\n    }\n\n    return groupCounter;\n  });\n\n  // eslint-disable-next-line no-unused-vars\n  const [maxHighlightIndex, _, maxHighlightIndexAtom] = useAtom((ctx) => {\n    const items = ctx.spy(itemsAtom);\n    const optionForCreate = ctx.spy(withOnCreateAtom);\n    const selectAll = ctx.spy(selectAllAtom);\n    const visibleItems = ctx.spy(visibleItemsAtom);\n\n    return (\n      items.length +\n      // кнопка для создания\n      (optionForCreate ? 1 : 0) +\n      // кнопки выбрать все\n      (selectAll ? visibleItems.length : 0)\n    );\n  });\n\n  const hasItemsAtom = useCreateAtom((ctx) => {\n    const items = ctx.spy(itemsAtom);\n    const optionForCreate = ctx.spy(optionForCreateAtom);\n\n    if (optionForCreate) {\n      return true;\n    }\n\n    return !!items.length;\n  });\n\n  const optionsRefs = useRefs<HTMLDivElement>(maxHighlightIndex, undefined);\n\n  const scrollToHighlightedIndex = useAction((ctx) => {\n    const items = ctx.get(itemsAtom);\n    const highlightedIndex = ctx.get(highlightedIndexAtom);\n    const listElement = listRef.current;\n\n    if (items.length > 0 && listElement) {\n      scrollToIndex(highlightedIndex, listElement, optionsRefs);\n    }\n  });\n\n  const highlightIndex = useAction(\n    (ctx, indexForHighlight: IndexForHighlight) => {\n      if (ctx.get(disabledAtom)) {\n        return;\n      }\n\n      highlightedIndexAtom(ctx, (state) => {\n        const newIndex = Math.min(\n          Math.max(\n            0,\n            typeof indexForHighlight === 'function'\n              ? indexForHighlight(state)\n              : indexForHighlight,\n          ),\n          ctx.get(maxHighlightIndexAtom) - 1,\n        );\n\n        return newIndex;\n      });\n    },\n  );\n\n  const removeValue = useAction(\n    (ctx, e: React.SyntheticEvent, valueItem: ITEM) => {\n      e.stopPropagation();\n      const props = ctx.get(propsAtom);\n\n      if (isMultipleParams(props)) {\n        const { getItemDisabled, getItemKey, onChange } = props;\n\n        const newValue = ctx.get(valueAtom).filter((item) => {\n          return getItemDisabled?.(item)\n            ? true\n            : getItemKey(item) !== getItemKey(valueItem);\n        });\n\n        onChange(newValue?.length ? newValue : null, {\n          e,\n        });\n      }\n    },\n  );\n\n  const onChange = useAction((ctx, e: React.SyntheticEvent, item: ITEM) => {\n    const { getItemDisabled, getItemKey, onChange, multiple, disabled } =\n      ctx.get(propsAtom);\n\n    if (disabled || (getItemDisabled && getItemDisabled(item))) {\n      return;\n    }\n\n    if (multiple) {\n      const value = ctx.get(valueAtom);\n      const newValue = value.some(\n        (value) => getItemKey(value) === getItemKey(item),\n      )\n        ? value.filter((value) => getItemKey(value) !== getItemKey(item))\n        : [...value, item];\n      const val = newValue.length ? newValue : null;\n      (onChange as FlatSelectPropOnChange<ITEM, true>)(val, { e });\n    } else {\n      (onChange as FlatSelectPropOnChange<ITEM, false>)(item, { e });\n    }\n  });\n\n  const onChangeAll = useAction(\n    (ctx, e: React.SyntheticEvent, items: ITEM[]) => {\n      const value = ctx.get(valueAtom);\n      const { getItemDisabled, getItemKey, multiple, onChange } =\n        ctx.get(propsAtom);\n\n      if (multiple) {\n        const nonDisabledItems = getItemDisabled\n          ? items.filter((item) => !getItemDisabled(item))\n          : items;\n\n        const currentGroupValues: ITEM[] = [];\n        const withoutGroupValues: ITEM[] = [];\n        value.forEach((el) => {\n          if (\n            nonDisabledItems.find((item) => getItemKey(el) === getItemKey(item))\n          ) {\n            currentGroupValues.push(el);\n          } else {\n            withoutGroupValues.push(el);\n          }\n        });\n        if (currentGroupValues.length === nonDisabledItems.length) {\n          (onChange as FlatSelectPropOnChange<ITEM, true>)(\n            withoutGroupValues.length ? withoutGroupValues : null,\n            { e },\n          );\n        } else {\n          const val = [...withoutGroupValues, ...nonDisabledItems];\n          (onChange as FlatSelectPropOnChange<ITEM, true>)(\n            val.length ? val : null,\n            { e },\n          );\n        }\n      }\n    },\n  );\n\n  const onCreate = useAction((ctx, e: React.SyntheticEvent) => {\n    const { onCreate } = ctx.get(propsAtom);\n    onCreate?.(ctx.get(inputValueAtom), { e });\n    onInput('');\n  });\n\n  // Handlers\n\n  const handleInputChange = useAction(\n    (ctx, e: React.ChangeEvent<HTMLInputElement>): void => {\n      if (!ctx.get(disabledAtom) && ctx.get(propsAtom).input) {\n        onInput?.(e.target.value);\n      }\n    },\n  );\n\n  const clearValue = useAction(() => onInput(''));\n\n  const getHandleRemoveValue = useAction(\n    (_, item: ITEM) => (e: React.SyntheticEvent) => removeValue(e, item),\n  );\n\n  // Prop Getters\n\n  const ArrowUp = useAction((ctx, e: KeyboardEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!ctx.get(disabledAtom)) {\n      highlightIndex((old) => old - 1);\n      scrollToHighlightedIndex();\n    }\n  });\n\n  const ArrowDown = useAction((ctx, e: KeyboardEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!ctx.get(disabledAtom)) {\n      highlightIndex((old) => old + 1);\n      scrollToHighlightedIndex();\n    }\n  });\n\n  const Enter = useAction((ctx, e: React.SyntheticEvent) => {\n    const { items } = ctx.get(propsAtom);\n    const highlightedIndex = ctx.get(highlightedIndexAtom);\n    const inputValue = ctx.get(inputValueAtom);\n    const visibleItems = ctx.get(visibleItemsAtom);\n\n    if (inputValue || items[highlightedIndex]) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    const getData = (\n      index: number,\n    ): [\n      CountedGroup<ITEM, GROUP> | undefined,\n      FlatSelectAllItem | OptionForCreate | ITEM | undefined,\n    ] => {\n      let counter = 0;\n\n      for (const group of visibleItems) {\n        if (isOptionForCreate(group)) {\n          if (counter === index) {\n            return [undefined, group];\n          }\n          counter++;\n          continue;\n        }\n        if (group.items.length + counter > index) {\n          return [group, group.items[index - counter]];\n        }\n        counter += group.items.length;\n      }\n      return [undefined, undefined];\n    };\n\n    const [group, item] = getData(highlightedIndex);\n\n    if (isOptionForCreate(item)) {\n      onCreate(e);\n      return;\n    }\n\n    if (isOptionForSelectAll(item)) {\n      onChangeAll(\n        e,\n        (group?.items.filter((el) => !isOptionForSelectAll(el)) as ITEM[]) ??\n          [],\n      );\n      return;\n    }\n\n    if (item) {\n      onChange(e, item);\n    }\n  }) as unknown as (e: KeyboardEvent) => void;\n\n  const Escape = useAction((ctx, e: KeyboardEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    openAtom(ctx, false);\n\n    ctx.get(anchorRefAtom)?.current?.focus();\n  });\n\n  const Tab = useAction((ctx, e: KeyboardEvent) => {\n    if (ctx.get(propsAtom).input && !ctx.get(inputFocusAtom)) {\n      return;\n    }\n    if (ctx.get(openAtom)) {\n      e.preventDefault();\n      e.stopPropagation();\n      openAtom(ctx, false);\n    }\n\n    ctx.get(anchorRefAtom)?.current?.focus();\n  });\n\n  const keysAtom = useCreateAtom<KeyHandlers>({\n    ArrowUp,\n    ArrowDown,\n    PageUp: ArrowUp,\n    PageDown: ArrowDown,\n    Home: ArrowUp,\n    End: ArrowDown,\n    Enter,\n    Escape,\n    Tab,\n  });\n\n  const getOptionActions = useAction(\n    (ctx, { index, item }: OptionProps<ITEM>): GetOptionPropsResult => {\n      if (isOptionForCreate(item)) {\n        return {\n          onClick: (e) => {\n            onCreate(e);\n            highlightIndex(index);\n          },\n          onMouseEnter: () => ctx.get(rootFocusAtom) && highlightIndex(index),\n        };\n      }\n      if (isOptionForSelectAll(item)) {\n        const getItems = (): ITEM[] => {\n          const visibleItems = ctx.get(visibleItemsAtom);\n          for (const group of visibleItems) {\n            if (isOptionForCreate(group)) {\n              continue;\n            }\n            if (group.key === item.groupKey) {\n              return (\n                (group?.items.filter(\n                  (el) => !isOptionForSelectAll(el),\n                ) as ITEM[]) ?? []\n              );\n            }\n          }\n          return [];\n        };\n        return {\n          onClick: (e: React.SyntheticEvent) => {\n            onChangeAll(e, getItems());\n            highlightIndex(index);\n          },\n          onMouseEnter: () => ctx.get(rootFocusAtom) && highlightIndex(index),\n        };\n      }\n\n      return {\n        onClick: (e: React.SyntheticEvent) => {\n          console.log('onClick', item);\n          highlightIndex(index);\n          onChange(e, item);\n        },\n        onMouseEnter: () => ctx.get(rootFocusAtom) && highlightIndex(index),\n      };\n    },\n  );\n\n  const handleInputFocus = useAction(\n    (ctx, e: React.FocusEvent<HTMLInputElement>): void => {\n      const { disabled, onInputFocus } = ctx.get(propsAtom);\n      const focused = ctx.get(inputFocusAtom);\n\n      if (!disabled) {\n        if (!focused) {\n          inputFocusAtom(ctx, true);\n        }\n        onInputFocus?.(e);\n      }\n    },\n  );\n\n  const handleInputBlur = useAction(\n    (ctx, e: React.FocusEvent<HTMLInputElement>): void => {\n      if (ctx.get(inputFocusAtom)) {\n        inputFocusAtom(ctx, false);\n      }\n\n      ctx.get(propsAtom).onInputBlur?.(e);\n    },\n  );\n\n  useClickOutsideAtom({\n    isActiveAtom: openAtom,\n    ignoreClicksElementsAtom: useCreateAtom((ctx) => {\n      const rootElement = ctx.spy(rootElementAtom);\n      const anchorElement = ctx.spy(anchorElementAtom);\n      const ignoreOutsideClicksElements = ctx\n        .spy(ignoreOutsideClicksRefsAtom)\n        ?.map((ref) => ref.current);\n\n      return [\n        rootElement,\n        anchorElement,\n        ...(ignoreOutsideClicksElements || []),\n      ];\n    }),\n    handler: useAction((ctx) => {\n      openAtom(ctx, false);\n    }),\n  });\n\n  useClickOutsideAtom({\n    isActiveAtom: rootFocusAtom,\n    ignoreClicksElementsAtom: useCreateAtom((ctx) => {\n      const rootElement = ctx.spy(rootElementAtom);\n\n      return [rootElement] as (HTMLElement | null)[];\n    }),\n    handler: handleRootBlur,\n  });\n\n  useUpdate(\n    (ctx, focus) => {\n      if (\n        focus &&\n        !ctx.get(rootMouseDownAtom) &&\n        ctx.get(highlightedIndexAtom) === -1 &&\n        !ctx.get(disabledAtom)\n      ) {\n        highlightedIndexAtom(ctx, 0);\n      }\n      if (!focus) {\n        highlightedIndexAtom(ctx, -1);\n      }\n    },\n    [rootFocusAtom],\n  );\n\n  useUpdate(\n    (ctx, inputValueProp = '') => {\n      const inputValue = ctx.get(inputValueAtom);\n\n      if (inputValueProp !== inputValue) {\n        onInput(inputValueProp);\n      }\n    },\n    [inputValuePropAtom],\n  );\n\n  useUpdate((ctx, openProp = false) => openAtom(ctx, openProp), [openPropAtom]);\n\n  useUpdate((ctx) => highlightedIndexAtom(ctx, -1), [visibleItemsAtom]);\n\n  useUpdate(\n    (ctx, disabledAtom) => disabledAtom && highlightedIndexAtom(ctx, -1),\n    [disabledAtom],\n  );\n\n  const handleAnchorClick = useAction((ctx) =>\n    openAtom(ctx, !ctx.get(openAtom)),\n  );\n\n  useElementAtomEventListener(anchorElementAtom, 'click', handleAnchorClick);\n  useElementAtomEventListener(rootElementAtom, 'focus', handleRootFocus);\n  useElementAtomEventListener(rootElementAtom, 'click', handleRootFocus);\n  useElementAtomEventListener(rootElementAtom, 'blur', handleRootBlur);\n  useElementAtomEventListener(\n    rootElementAtom,\n    'mousedown',\n    handleRootMouseDown,\n  );\n  useElementAtomEventListener(rootElementAtom, 'mouseup', handleRootMouseUp);\n\n  useKeysAtom({\n    keysAtom,\n    elAtom: rootElementAtom,\n    isActiveAtom: useCreateAtom((ctx) => {\n      if (ctx.spy(anchorRefAtom)?.current && ctx.spy(openAtom)) {\n        return true;\n      }\n      return !ctx.spy(disabledAtom);\n    }),\n  });\n\n  useUpdate(\n    async (ctx, open) => {\n      ctx.get(propsAtom).onOpen?.(open);\n      await sleep(animateTimeout);\n      if (!open) {\n        onInput('');\n        inputFocusAtom(ctx, false);\n        rootFocusAtom(ctx, false);\n        return;\n      }\n      if (open) {\n        ctx.get(rootElementAtom)?.focus();\n      }\n    },\n    [openAtom],\n  );\n\n  return {\n    openAtom,\n    inputFocusAtom,\n    inputValueAtom,\n    clearButtonAtom,\n    onInput,\n    getOptionActions,\n    handleInputBlur,\n    getHandleRemoveValue,\n    inputRef,\n    listRef,\n    handleInputChange,\n    handleInputFocus,\n    visibleItemsAtom,\n    clearValue,\n    optionsRefs,\n    highlightedIndexAtom,\n    valueAtom,\n    getItemKeyAtom,\n    onChangeAll,\n    onCreate,\n    onChange,\n    hasItemsAtom,\n    groupsCounterAtom,\n    dropdownZIndexAtom,\n    rootRef,\n    disabledAtom,\n  };\n};\n"],"mappings":"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"}