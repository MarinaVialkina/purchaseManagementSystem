{"version":3,"file":"useOnChange.js","names":["getHours","getMinutes","getSeconds","set","startOfDay","startOfToday","useCallback","useEffect","useMutableRef","getFirstValidDateTime","getDisableDatesKey","getTimeOptionsKey","getTime","date","useOnChange","onChange","onChangeRange","value","timeFor","timeOptions","minDate","maxDate","disableDates","isRange","Array","isArray","normalizeValue","previousRangeRef","onChangeRef","onChangeRangeRef","getValidTimeValue","startOfDayDate","validValue","applyTimeToRange","range","timeSource","hours","minutes","seconds","start","end","newStart","newEnd","onDateChange","e","current","onDateChangeRange","currentRange","timeForEnd","prevTimeForEnd","isTimeForEndChanged","validTimeValue","newRange","onTimeChange","selectedValue"],"sources":["../../../../../../src/components/DateTime/DateTimeTypeDateTime/useOnChange.ts"],"sourcesContent":["import {\n  getHours,\n  getMinutes,\n  getSeconds,\n  set,\n  startOfDay,\n  startOfToday,\n} from 'date-fns';\nimport { useCallback, useEffect } from 'react';\n\nimport { useMutableRef } from '../../../hooks/useMutableRef/useMutableRef';\nimport { DateRange } from '../../../utils/types/Date';\nimport { getFirstValidDateTime } from '../DateTimeTypeTime/helpers';\nimport {\n  DateTimePropDisableDates,\n  DateTimePropOnChange,\n  DateTimePropOnChangeRange,\n  TimeOptions,\n} from '../helpers';\nimport { getDisableDatesKey } from '../helpers/getDisableDatesKey';\nimport { getTimeOptionsKey } from '../helpers/getTimeOptionsKey';\n\nconst getTime = (date?: Date) => {\n  if (!date) {\n    return [0, 0, 0] as const;\n  }\n  return [getHours(date), getMinutes(date), getSeconds(date)] as const;\n};\n\nexport const useOnChange = (\n  onChange: DateTimePropOnChange | undefined,\n  onChangeRange: DateTimePropOnChangeRange<'date-time'> | undefined,\n  value: DateRange | Date | undefined,\n  timeFor: 'start' | 'end',\n  timeOptions?: TimeOptions,\n  minDate?: Date,\n  maxDate?: Date,\n  disableDates?: DateTimePropDisableDates,\n): [\n  DateTimePropOnChange,\n  DateTimePropOnChangeRange<'date-time'>,\n  DateTimePropOnChange,\n  Date | undefined,\n] => {\n  const isRange = value !== undefined && Array.isArray(value);\n  const normalizeValue = isRange ? value[timeFor === 'start' ? 0 : 1] : value;\n\n  const previousRangeRef = useMutableRef<Date | undefined>(\n    isRange ? normalizeValue : undefined,\n  );\n\n  const onChangeRef = useMutableRef(onChange);\n  const onChangeRangeRef = useMutableRef(onChangeRange);\n\n  const getValidTimeValue = useCallback(\n    (value: Date | undefined): Date => {\n      const startOfDayDate = startOfDay(value || startOfToday());\n\n      const validValue = getFirstValidDateTime(\n        startOfDayDate,\n        timeOptions,\n        minDate,\n        maxDate,\n        disableDates,\n      );\n      return validValue;\n    },\n    [\n      getTimeOptionsKey(timeOptions),\n      minDate?.getTime(),\n      maxDate?.getTime(),\n      getDisableDatesKey(disableDates),\n    ],\n  );\n\n  const applyTimeToRange = (\n    range: DateRange,\n    timeSource: Date | undefined,\n  ): DateRange => {\n    if (!timeSource) return range;\n    const [hours, minutes, seconds] = getTime(timeSource);\n    const [start, end] = range;\n\n    const newStart = start ? set(start, { hours, minutes, seconds }) : start;\n    const newEnd = end ? set(end, { hours, minutes, seconds }) : end;\n\n    return [newStart, newEnd];\n  };\n\n  const onDateChange: DateTimePropOnChange = useCallback(\n    (value, { e }) => {\n      const validValue = getValidTimeValue(value);\n      onChangeRef.current?.(validValue, {\n        e,\n      });\n    },\n    [getValidTimeValue],\n  );\n\n  const onDateChangeRange: DateTimePropOnChangeRange<'date-time'> = useCallback(\n    (value, { e }) => {\n      const currentRange = value as DateRange;\n      const timeForEnd =\n        timeFor === 'start' ? currentRange[0] : currentRange[1];\n      const prevTimeForEnd = previousRangeRef.current || undefined;\n      const isTimeForEndChanged =\n        timeForEnd?.getTime() !== prevTimeForEnd?.getTime();\n      const validTimeValue = isTimeForEndChanged\n        ? getValidTimeValue(timeForEnd)\n        : timeForEnd;\n      const newRange = applyTimeToRange(currentRange, validTimeValue);\n      onChangeRangeRef.current?.(newRange, { e });\n    },\n    [timeFor, getValidTimeValue],\n  );\n\n  const onTimeChange: DateTimePropOnChange = useCallback(\n    (selectedValue, { e }) => {\n      onChangeRef.current?.(selectedValue, { e });\n    },\n    [],\n  );\n\n  useEffect(() => {\n    previousRangeRef.current = isRange ? normalizeValue : undefined;\n  }, [isRange, normalizeValue?.getTime()]);\n\n  return [onDateChange, onDateChangeRange, onTimeChange, normalizeValue];\n};\n"],"mappings":"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"}