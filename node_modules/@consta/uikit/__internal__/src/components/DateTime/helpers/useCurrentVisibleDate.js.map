{"version":3,"file":"useCurrentVisibleDate.js","names":["useEffect","useMemo","useState","isNumber","clampDate","currentDate","minDate","maxDate","currentDateTime","getTime","calculateCurrentVisibleDate","currentVisibleDate","value","rangeIndex","Array","isArray","date","Date","getCurrentVisibleDate","props","startOfUnit","useCurrentVisibleDate","state","onChangeCurrentVisibleDate"],"sources":["../../../../../../src/components/DateTime/helpers/useCurrentVisibleDate.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\n\nimport { isNumber } from '##/utils/type-guards';\nimport { DateRange } from '##/utils/types/Date';\n\ntype GetCurrentVisibleDateProps = {\n  currentVisibleDate: Date | undefined;\n  minDate: Date | undefined;\n  maxDate: Date | undefined;\n  value: Date | DateRange | undefined | null;\n  startOfUnit: (date: Date) => Date;\n  onChangeCurrentVisibleDate?: (date: Date) => void;\n  rangeIndex?: number;\n};\n\nexport type UseCurrentVisibleDateProps = GetCurrentVisibleDateProps & {\n  onChangeCurrentVisibleDate?: (date: Date) => void;\n};\n\nconst clampDate = (\n  currentDate: Date,\n  minDate: Date | undefined,\n  maxDate: Date | undefined,\n): Date => {\n  const currentDateTime = currentDate.getTime();\n\n  if (minDate && currentDateTime < minDate.getTime()) {\n    return minDate;\n  }\n\n  if (maxDate && currentDateTime > maxDate.getTime()) {\n    return maxDate;\n  }\n\n  return currentDate;\n};\n\nconst calculateCurrentVisibleDate = ({\n  currentVisibleDate,\n  minDate,\n  maxDate,\n  value,\n  rangeIndex,\n}: GetCurrentVisibleDateProps): Date => {\n  if (currentVisibleDate) {\n    return currentVisibleDate;\n  }\n\n  if (Array.isArray(value) && isNumber(rangeIndex)) {\n    const date = value[rangeIndex];\n    if (date) {\n      return date;\n    }\n  }\n\n  if (Array.isArray(value) && value[0]) {\n    return value[0];\n  }\n\n  if (Array.isArray(value) && value[1]) {\n    return value[1];\n  }\n\n  if (value && !Array.isArray(value)) {\n    return value;\n  }\n\n  // По хорошему было бы неплохо абстрагировать получение текущей даты\n  // чтобы не использовать mocks через jest\n  const currentDate = new Date();\n\n  return clampDate(currentDate, minDate, maxDate);\n};\n\nexport const getCurrentVisibleDate = (\n  props: GetCurrentVisibleDateProps,\n): Date => props.startOfUnit(calculateCurrentVisibleDate(props));\n\nexport const useCurrentVisibleDate = (props: UseCurrentVisibleDateProps) => {\n  const currentVisibleDate = useMemo(() => {\n    return getCurrentVisibleDate(props);\n  }, [\n    props.currentVisibleDate?.getTime() || 0,\n    props.minDate?.getTime() || 0,\n    props.maxDate?.getTime() || 0,\n  ]);\n\n  const state = useState<Date>(currentVisibleDate);\n\n  useEffect(() => state[1](currentVisibleDate), [currentVisibleDate.getTime()]);\n\n  useEffect(\n    () => state[0] && props.onChangeCurrentVisibleDate?.(state[0]),\n    [state[0]?.getTime()],\n  );\n\n  return state;\n};\n"],"mappings":"AAAA,OAASA,SAAT,CAAoBC,OAApB,CAA6BC,QAA7B,KAA6C,OAA7C,CAEA,OAASC,QAAT,kC,GAiBMC,UAAS,CAAG,SAChBC,CADgB,CAEhBC,CAFgB,CAGhBC,CAHgB,CAIP,CACT,GAAMC,EAAe,CAAGH,CAAW,CAACI,OAAZ,EAAxB,CADS,MAGLH,EAAO,EAAIE,CAAe,CAAGF,CAAO,CAACG,OAAR,EAHxB,CAIAH,CAJA,CAOLC,CAAO,EAAIC,CAAe,CAAGD,CAAO,CAACE,OAAR,EAPxB,CAQAF,CARA,CAWFF,CACR,C,CAEKK,2BAA2B,CAAG,WAMI,IALtCC,EAKsC,GALtCA,kBAKsC,CAJtCL,CAIsC,GAJtCA,OAIsC,CAHtCC,CAGsC,GAHtCA,OAGsC,CAFtCK,CAEsC,GAFtCA,KAEsC,CADtCC,CACsC,GADtCA,UACsC,CACtC,GAAIF,CAAJ,CACE,MAAOA,EAAP,CAGF,GAAIG,KAAK,CAACC,OAAN,CAAcH,CAAd,GAAwBT,QAAQ,CAACU,CAAD,CAApC,CAAkD,CAChD,GAAMG,EAAI,CAAGJ,CAAK,CAACC,CAAD,CAAlB,CACA,GAAIG,CAAJ,CACE,MAAOA,EAEV,CAED,GAAIF,KAAK,CAACC,OAAN,CAAcH,CAAd,GAAwBA,CAAK,CAAC,CAAD,CAAjC,CACE,MAAOA,EAAK,CAAC,CAAD,CAAZ,CAGF,GAAIE,KAAK,CAACC,OAAN,CAAcH,CAAd,GAAwBA,CAAK,CAAC,CAAD,CAAjC,CACE,MAAOA,EAAK,CAAC,CAAD,CAAZ,CAGF,GAAIA,CAAK,EAAI,CAACE,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAd,CACE,MAAOA,EAAP,CAKF,GAAMP,EAAW,CAAG,GAAIY,KAAxB,CAEA,MAAOb,UAAS,CAACC,CAAD,CAAcC,CAAd,CAAuBC,CAAvB,CACjB,C,CAED,MAAO,IAAMW,sBAAqB,CAAG,SACnCC,CADmC,QAE1BA,EAAK,CAACC,WAAN,CAAkBV,2BAA2B,CAACS,CAAD,CAA7C,CAF0B,CAA9B,CAIP,MAAO,IAAME,sBAAqB,CAAG,SAACF,CAAD,CAAuC,aACpER,CAAkB,CAAGV,OAAO,CAAC,UAAM,CACvC,MAAOiB,sBAAqB,CAACC,CAAD,CAC7B,CAFiC,CAE/B,CACD,WAAAA,CAAK,CAACR,kBAAN,uBAA0BF,OAA1B,KAAuC,CADtC,CAED,WAAAU,CAAK,CAACb,OAAN,uBAAeG,OAAf,KAA4B,CAF3B,CAGD,WAAAU,CAAK,CAACZ,OAAN,uBAAeE,OAAf,KAA4B,CAH3B,CAF+B,CADwC,CASpEa,CAAK,CAAGpB,QAAQ,CAAOS,CAAP,CAToD,CAkB1E,MAPAX,UAAS,CAAC,iBAAMsB,EAAK,CAAC,CAAD,CAAL,CAASX,CAAT,CAAN,CAAD,CAAqC,CAACA,CAAkB,CAACF,OAAnB,EAAD,CAArC,CAOT,CALAT,SAAS,CACP,uBAAMsB,EAAK,CAAC,CAAD,CAAL,aAAYH,CAAK,CAACI,0BAAlB,qBAAY,OAAAJ,CAAK,CAA8BG,CAAK,CAAC,CAAD,CAAnC,CAAjB,CAAN,CADO,CAEP,WAACA,CAAK,CAAC,CAAD,CAAN,qBAAC,EAAUb,OAAV,EAAD,CAFO,CAKT,CAAOa,CACR,CAnBM"}