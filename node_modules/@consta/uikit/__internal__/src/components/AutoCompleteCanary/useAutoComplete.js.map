{"version":3,"file":"useAutoComplete.js","names":["useCallback","useEffect","useMemo","useRef","useState","scrollToIndex","useClickOutside","useFlag","useKeys","useRefs","getGroups","useAutoComplete","params","items","dropdownRef","disabled","getItemLabel","getItemKey","searchFunction","getItemGroupKey","groups","getGroupKey","onFocus","onBlur","isLoading","dropdownOpen","onDropdownOpen","ignoreOutsideClicksRefs","searchValue","onChange","inputRef","isOpen","setIsOpen","highlightedIndex","setHighlightedIndex","handleChange","value","props","current","focus","searchFunctionDefault","item","toLocaleLowerCase","indexOf","filteredOptions","filter","visibleItems","resultGroups","length","hasItems","find","group","highlightIndex","indexForHighlight","Math","min","max","ArrowUp","_","e","preventDefault","on","old","ArrowDown","returnIsOpen","getKeyProps","PageUp","PageDown","Home","End","Enter","getItem","index","counter","Escape","off","Tab","blur","optionsRefs","isActive","ignoreClicksInsideRefs","handler","set","getOptionProps","key","onClick","onMouseEnter","active","hovered","handleInputFocus","handleInputBlur"],"sources":["../../../../../src/components/AutoCompleteCanary/useAutoComplete.ts"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { scrollToIndex } from '##/components/SelectComponents/useSelect/helpers';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useFlag } from '##/hooks/useFlag';\nimport { KeyHandler, useKeys } from '##/hooks/useKeysDeprecated';\nimport { useRefs } from '##/hooks/useRefs';\nimport { getGroups } from '##/utils/getGroups';\n\nimport { AutoCompletePropOnChange } from './types';\n\ntype IndexForHighlight = number | ((oldIndex: number) => number);\n\ntype GetItemGroupKey<ITEM> = (item: ITEM) => string | number | undefined;\ntype GetGroupKey<GROUP> = (item: GROUP) => string | number | undefined;\n\ntype UseAutoCompleteProps<ITEM, GROUP> = {\n  getItemGroupKey?: GetItemGroupKey<ITEM> | undefined;\n  getGroupKey?: GetGroupKey<GROUP>;\n  groups?: GROUP[];\n  items: ITEM[];\n  dropdownRef: React.MutableRefObject<HTMLDivElement | null>;\n  disabled?: boolean;\n  getItemLabel: (item: ITEM) => string;\n  getItemKey: (item: ITEM) => string | number;\n  searchFunction?: (item: ITEM, searchValue: string) => boolean;\n  onFocus?: React.FocusEventHandler<HTMLInputElement>;\n  onBlur?: React.FocusEventHandler<HTMLInputElement>;\n  searchValue?: string;\n  onChange?: AutoCompletePropOnChange<'text'>;\n  isLoading?: boolean;\n  dropdownOpen?: boolean;\n  onDropdownOpen?: (isOpen: boolean) => void;\n  ignoreOutsideClicksRefs?: ReadonlyArray<React.RefObject<HTMLElement>>;\n};\n\ntype OptionProps<ITEM> = {\n  index: number;\n  item: ITEM;\n  keyPrefix: number;\n};\n\ntype GetOptionPropsResult = {\n  onClick: (e: React.MouseEvent) => void;\n  onMouseEnter: (e: React.MouseEvent) => void;\n  active: boolean;\n  hovered: boolean;\n  key: string | number;\n};\n\nexport function useAutoComplete<ITEM, GROUP>(\n  params: UseAutoCompleteProps<ITEM, GROUP>,\n) {\n  const {\n    items,\n    dropdownRef,\n    disabled = false,\n    getItemLabel,\n    getItemKey,\n    searchFunction,\n    getItemGroupKey,\n    groups,\n    getGroupKey,\n    onFocus,\n    onBlur,\n    isLoading,\n    dropdownOpen,\n    onDropdownOpen,\n    ignoreOutsideClicksRefs,\n    searchValue = '',\n    onChange,\n  } = params;\n\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const [isOpen, setIsOpen] = useFlag();\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(-1);\n\n  const handleChange: AutoCompletePropOnChange<'text'> = (value, props) => {\n    if (!disabled && onChange) {\n      onChange(value, props);\n    }\n    inputRef.current?.focus();\n    setHighlightedIndex(-1);\n  };\n\n  const searchFunctionDefault = (item: ITEM, searchValue: string) => {\n    if (!searchValue) {\n      return false;\n    }\n    return (\n      getItemLabel(item)\n        .toLocaleLowerCase()\n        .indexOf(searchValue.toLocaleLowerCase()) !== -1\n    );\n  };\n\n  const filteredOptions = useMemo(\n    () =>\n      items.filter((item) =>\n        searchFunction\n          ? searchFunction(item, searchValue || '')\n          : searchFunctionDefault(item, searchValue || ''),\n      ),\n    [searchValue, items],\n  );\n\n  const visibleItems = useMemo(() => {\n    const resultGroups = getGroups(\n      filteredOptions,\n      groups?.length ? getItemGroupKey : undefined,\n      groups,\n      getGroupKey,\n      undefined,\n    );\n\n    return resultGroups;\n  }, [filteredOptions, groups, getItemGroupKey, getGroupKey]);\n\n  const hasItems = useMemo(() => {\n    return !!visibleItems.find((group) => group.items.length > 0);\n  }, [visibleItems]);\n\n  const highlightIndex = useCallback(\n    (indexForHighlight: IndexForHighlight) => {\n      setHighlightedIndex(\n        Math.min(\n          Math.max(\n            0,\n            typeof indexForHighlight === 'function'\n              ? indexForHighlight(highlightedIndex)\n              : indexForHighlight,\n          ),\n          filteredOptions.length - 1,\n        ),\n      );\n    },\n    [filteredOptions, highlightedIndex],\n  );\n\n  const ArrowUp: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old - 1);\n    }\n  };\n\n  const ArrowDown: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old + 1);\n    }\n  };\n\n  const Enter: KeyHandler = (_, e): void => {\n    if (isOpen) {\n      if (searchValue || filteredOptions[highlightedIndex]) {\n        e.preventDefault();\n      }\n\n      const getItem = (index: number) => {\n        let counter = 0;\n        for (const group of visibleItems) {\n          if (group.items.length + counter > index) {\n            return group.items[index - counter];\n          }\n          counter += group.items.length;\n        }\n        return undefined;\n      };\n\n      const item = getItem(highlightedIndex);\n\n      if (item) {\n        handleChange(getItemLabel(item), { e });\n      }\n    } else {\n      setIsOpen.on();\n    }\n  };\n\n  const Escape: KeyHandler = (): void => {\n    setIsOpen.off();\n  };\n\n  const returnIsOpen = Boolean(isOpen && (isLoading ? true : hasItems));\n\n  const Tab: KeyHandler = (_, e): void => {\n    setIsOpen.off();\n    if (returnIsOpen) {\n      e.preventDefault();\n    } else {\n      inputRef.current?.blur();\n    }\n  };\n\n  const getKeyProps = useKeys({\n    ArrowUp,\n    ArrowDown,\n    PageUp: ArrowUp,\n    PageDown: ArrowDown,\n    Home: ArrowUp,\n    End: ArrowDown,\n    Enter,\n    Escape,\n    Tab,\n  });\n\n  const getOptionProps = ({\n    index,\n    item,\n  }: OptionProps<ITEM>): GetOptionPropsResult => {\n    const key = getItemKey(item) || getItemLabel(item);\n\n    return {\n      onClick: (e: React.MouseEvent) => {\n        handleChange(getItemLabel(item), { e });\n      },\n      onMouseEnter: () => {\n        highlightIndex(index);\n      },\n      active: false,\n      hovered: index === highlightedIndex,\n      key,\n    };\n  };\n\n  const optionsRefs = useRefs<HTMLDivElement>(filteredOptions.length, [isOpen]);\n\n  const handleInputFocus = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (!disabled) {\n      setIsOpen.on();\n      onFocus?.(e);\n    }\n  };\n\n  const handleInputBlur = (e: React.FocusEvent<HTMLInputElement>): void => {\n    onBlur?.(e);\n  };\n\n  useClickOutside({\n    isActive: isOpen,\n    ignoreClicksInsideRefs: [dropdownRef, ...(ignoreOutsideClicksRefs || [])],\n    handler: setIsOpen.off,\n  });\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen.off();\n      inputRef.current?.blur();\n    }\n  }, [disabled]);\n\n  useEffect(() => {\n    if (filteredOptions.length > 0) {\n      scrollToIndex(highlightedIndex, dropdownRef, optionsRefs, () =>\n        highlightIndex(0),\n      );\n    }\n    setIsOpen.on();\n  }, [highlightedIndex]);\n\n  useEffect(() => {\n    onDropdownOpen?.(returnIsOpen);\n\n    if (returnIsOpen) {\n      setHighlightedIndex(0);\n    }\n  }, [returnIsOpen]);\n\n  useEffect(() => {\n    setIsOpen.set(dropdownOpen || false);\n  }, [dropdownOpen]);\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.value = searchValue;\n    }\n  }, [searchValue]);\n\n  return {\n    isOpen: returnIsOpen,\n    visibleItems,\n    getOptionProps,\n    handleInputFocus,\n    inputRef,\n    getKeyProps,\n    hasItems,\n    optionsRefs,\n    handleChange,\n    highlightedIndex,\n    handleInputBlur,\n  };\n}\n"],"mappings":"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"}