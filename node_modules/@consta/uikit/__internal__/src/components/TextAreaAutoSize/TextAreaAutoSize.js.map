{"version":3,"file":"TextAreaAutoSize.js","names":["useAction","useAtom","useUpdate","React","forwardRef","createPortal","useForkRef","cn","deepEqual","useCreateAtom","useRefAtom","useResizeObservedAtom","useSendToAtom","withCtx","cnTextAreaAutoSize","TextAreaAutoSize","props","ref","minRows","maxRows","onChange","style","className","restProps","textAreaElementAtom","textAreaRef","fakeElementAtom","fakeRef","textareaStyles","textareaStylesAtom","fakeStyles","fakeStylesAtom","propsAtom","calculateHeight","ctx","textAreaElement","get","fakeElement","textAreaStyles","getComputedStyle","newFakeStyles","minHeight","maxHeight","width","padding","paddingBottom","paddingTop","paddingLeft","paddingRight","margin","border","borderTop","borderBottom","borderLeft","borderRight","fontFamily","fontSize","lineHeight","tabSize","textIndent","textRendering","textTransform","display","whiteSpace","wordBreak","computedStyle","parseFloat","borderTopWidth","borderBottomWidth","gap","newHeight","scrollHeight","finalHeight","Math","min","max","isNaN","newTextareaStyles","height","overflowY","handleChange","e","value","target","spy","id","name","document","body"],"sources":["../../../../../src/components/TextAreaAutoSize/TextAreaAutoSize.tsx"],"sourcesContent":["import './TextAreaAutoSize.css';\n\nimport { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { forwardRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { cn } from '##/utils/bem';\nimport { deepEqual } from '##/utils/objectCompare';\nimport {\n  useCreateAtom,\n  useRefAtom,\n  useResizeObservedAtom,\n  useSendToAtom,\n  withCtx,\n} from '##/utils/state';\n\nexport const cnTextAreaAutoSize = cn('TextAreaAutoSize');\n\nexport type TextAreaAutoSizeProps = {\n  minRows?: number;\n  maxRows?: number;\n} & React.TextareaHTMLAttributes<HTMLTextAreaElement>;\n\nexport const TextAreaAutoSize = withCtx(\n  forwardRef<HTMLTextAreaElement, TextAreaAutoSizeProps>((props, ref) => {\n    const {\n      minRows = 1,\n      maxRows,\n      onChange,\n      style,\n      className,\n      ...restProps\n    } = props;\n\n    const [textAreaElementAtom, textAreaRef] =\n      useRefAtom<HTMLTextAreaElement>();\n    const [fakeElementAtom, fakeRef] = useRefAtom<HTMLTextAreaElement>();\n\n    const [textareaStyles, , textareaStylesAtom] = useAtom<React.CSSProperties>(\n      {},\n    );\n    const [fakeStyles, , fakeStylesAtom] = useAtom<React.CSSProperties>({});\n\n    const propsAtom = useSendToAtom(props);\n\n    const calculateHeight = useAction((ctx) => {\n      const textAreaElement = ctx.get(textAreaElementAtom);\n      const fakeElement = ctx.get(fakeElementAtom);\n\n      if (!textAreaElement || !fakeElement) return;\n      const textAreaStyles = getComputedStyle(textAreaElement);\n\n      const newFakeStyles = {\n        minHeight: textAreaStyles.minHeight,\n        maxHeight: textAreaStyles.maxHeight,\n        width: textAreaStyles.width,\n        padding: textAreaStyles.padding,\n        paddingBottom: textAreaStyles.paddingBottom,\n        paddingTop: textAreaStyles.paddingTop,\n        paddingLeft: textAreaStyles.paddingLeft,\n        paddingRight: textAreaStyles.paddingRight,\n        margin: textAreaStyles.margin,\n        border: textAreaStyles.border,\n        borderTop: textAreaStyles.borderTop,\n        borderBottom: textAreaStyles.borderBottom,\n        borderLeft: textAreaStyles.borderLeft,\n        borderRight: textAreaStyles.borderRight,\n        fontFamily: textAreaStyles.fontFamily,\n        fontSize: textAreaStyles.fontSize,\n        lineHeight: textAreaStyles.lineHeight,\n        tabSize: textAreaStyles.tabSize,\n        textIndent: textAreaStyles.textIndent,\n        textRendering: textAreaStyles.textRendering,\n        textTransform: textAreaStyles.textTransform,\n        display: textAreaStyles.display,\n        whiteSpace: textAreaStyles.whiteSpace,\n        wordBreak: textAreaStyles.wordBreak,\n      } as React.CSSProperties;\n\n      if (!deepEqual(newFakeStyles, ctx.get(fakeStylesAtom))) {\n        fakeStylesAtom(ctx, newFakeStyles);\n      }\n\n      const computedStyle = getComputedStyle(fakeElement);\n      const lineHeight = parseFloat(computedStyle.lineHeight);\n\n      const paddingTop = parseFloat(computedStyle.paddingTop);\n      const paddingBottom = parseFloat(computedStyle.paddingBottom);\n      const borderTop = parseFloat(computedStyle.borderTopWidth);\n      const borderBottom = parseFloat(computedStyle.borderBottomWidth);\n\n      const gap = paddingTop + paddingBottom + borderTop + borderBottom;\n\n      const newHeight = fakeElement.scrollHeight;\n\n      const minHeight = minRows * lineHeight + gap;\n      const maxHeight = maxRows ? maxRows * lineHeight + gap : Infinity;\n\n      const finalHeight = Math.min(Math.max(newHeight, minHeight), maxHeight);\n\n      if (isNaN(finalHeight)) {\n        return;\n      }\n\n      const newTextareaStyles: React.CSSProperties = {\n        height: `${finalHeight}px`,\n        overflowY: maxRows && newHeight > maxHeight ? 'scroll' : 'hidden',\n      };\n\n      if (!deepEqual(newTextareaStyles, ctx.get(textareaStylesAtom))) {\n        textareaStylesAtom(ctx, newTextareaStyles);\n      }\n    });\n\n    const handleChange: React.ChangeEventHandler<HTMLTextAreaElement> =\n      useAction((ctx, e) => {\n        ctx.get(propsAtom).onChange?.(e);\n        const fakeElement = ctx.get(fakeElementAtom);\n        if (fakeElement) {\n          fakeElement.value = e.target.value;\n        }\n        calculateHeight();\n      });\n\n    useUpdate(calculateHeight, [\n      minRows,\n      maxRows,\n      fakeElementAtom,\n      textAreaElementAtom,\n    ]);\n\n    useResizeObservedAtom(\n      useCreateAtom((ctx) => [\n        ctx.spy(textAreaElementAtom),\n        ctx.get(fakeElementAtom),\n      ]),\n      calculateHeight,\n    );\n\n    useCreateAtom((ctx) => {\n      const fakeElement = ctx.spy(fakeElementAtom);\n      const textAreaElement = ctx.spy(textAreaElementAtom);\n      if (fakeElement && textAreaElement) {\n        fakeElement.value = textAreaElement.value;\n        calculateHeight();\n      }\n    });\n\n    return (\n      <>\n        <textarea\n          {...restProps}\n          ref={useForkRef([textAreaRef, ref])}\n          onChange={handleChange}\n          style={{ ...style, ...textareaStyles }}\n          className={cnTextAreaAutoSize(null, [className])}\n        />\n        {createPortal(\n          <textarea\n            ref={fakeRef}\n            style={fakeStyles}\n            className={cnTextAreaAutoSize('Fake')}\n            id={cnTextAreaAutoSize('Fake', {\n              id: restProps.id,\n              name: restProps.name,\n            })}\n          />,\n          document.body,\n        )}\n      </>\n    );\n  }),\n);\n"],"mappings":"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"}