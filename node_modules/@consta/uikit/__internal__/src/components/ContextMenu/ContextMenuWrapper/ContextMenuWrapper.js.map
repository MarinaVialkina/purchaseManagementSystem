{"version":3,"file":"ContextMenuWrapper.js","names":["React","Fragment","useCallback","useRef","useState","Transition","cnListBox","mapVerticalSpace","Popover","useFlag","useMutableRef","animateTimeout","cnMixPopoverAnimate","cnMixSpace","cn","contextMenuDefaultSize","defaultContextMenuForm","cnContextMenuWrapper","ContextMenuWrapper","props","isMobile","children","form","isOpen","size","anchorRef","possibleDirections","position","directionProp","direction","spareDirection","onClickOutside","offset","onSetDirectionProp","onSetDirection","className","animationBack","style","innerAnimation","setInnerAnimation","setDirection","onSetDirectionRef","rootRef","current","on","off","animate","border","shadow","pV","name"],"sources":["../../../../../../src/components/ContextMenu/ContextMenuWrapper/ContextMenuWrapper.tsx"],"sourcesContent":["import './ContextMenuWrapper.css';\n\nimport React, { Fragment, useCallback, useRef, useState } from 'react';\nimport { Transition } from 'react-transition-group';\n\nimport { cnListBox, mapVerticalSpace } from '##/components/ListCanary';\nimport { Direction, Popover } from '##/components/Popover';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { animateTimeout, cnMixPopoverAnimate } from '##/mixs/MixPopoverAnimate';\nimport { cnMixSpace } from '##/mixs/MixSpace';\nimport { cn } from '##/utils/bem';\n\nimport {\n  contextMenuDefaultSize,\n  ContextMenuWrapperProps,\n  defaultContextMenuForm,\n} from '../types';\n\nconst cnContextMenuWrapper = cn('ContextMenuWrapper');\n\nexport const ContextMenuWrapper = (props: ContextMenuWrapperProps) => {\n  const {\n    isMobile,\n    children,\n    form = defaultContextMenuForm,\n    isOpen,\n    size = contextMenuDefaultSize,\n    anchorRef,\n    possibleDirections,\n    position,\n    direction: directionProp,\n    spareDirection,\n    onClickOutside,\n    offset,\n    onSetDirection: onSetDirectionProp,\n    className,\n    animationBack,\n    style,\n  } = props;\n\n  const [innerAnimation, setInnerAnimation] = useFlag(isMobile);\n  // запоминаем позицию последнего удовлетворяющего разворота,\n  // для того чтоб следующий экран разворачивался в эту же строну.\n  const [direction, setDirection] = useState(directionProp);\n\n  const onSetDirectionRef = useMutableRef(onSetDirectionProp);\n\n  const rootRef = useRef<HTMLDivElement>(null);\n\n  const onSetDirection = useCallback((direction: Direction) => {\n    setDirection(direction);\n    onSetDirectionRef.current?.(direction);\n  }, []);\n\n  if (isMobile) {\n    return (\n      <Transition\n        timeout={animateTimeout}\n        in={isOpen}\n        unmountOnExit\n        onEntered={setInnerAnimation.on}\n        onExit={setInnerAnimation.off}\n        nodeRef={rootRef}\n      >\n        {(animate) => (\n          <Popover\n            className={cnContextMenuWrapper({ animationBack, innerAnimation }, [\n              cnListBox({ size, form, border: true, shadow: true }),\n              cnMixSpace({\n                pV: mapVerticalSpace[size],\n              }),\n              cnMixPopoverAnimate({ animate }),\n              className,\n            ])}\n            ref={rootRef}\n            anchorRef={anchorRef}\n            possibleDirections={possibleDirections}\n            position={position}\n            direction={direction}\n            spareDirection={spareDirection}\n            onClickOutside={onClickOutside}\n            offset={offset}\n            onSetDirection={onSetDirection}\n            style={style}\n          >\n            {children}\n          </Popover>\n        )}\n      </Transition>\n    );\n  }\n\n  return <Fragment key={ContextMenuWrapper.name}>{children}</Fragment>;\n};\n"],"mappings":"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"}