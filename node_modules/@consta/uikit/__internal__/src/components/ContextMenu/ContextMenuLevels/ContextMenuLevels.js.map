{"version":3,"file":"ContextMenuLevels.js","names":["React","Fragment","useEffect","useState","Transition","TransitionGroup","useClickOutside","useMutableRef","useRefs","animateTimeout","setRef","clearTimers","ContextMenuLevel","getLevels","withDefaultGetters","contextMenuPropDefaultSubMenuDirection","contextMenuPropSubMenuDirections","useSize","ContextMenuLevels","propsComponent","props","items","anchorRef","position","direction","possibleDirections","offset","onClickOutside","getItemKey","getItemLabel","getItemSubMenu","style","spareDirection","subMenuDirection","subMenuDirectionProp","isMobile","isOpen","setComponentSize","enableAnimationBack","disableAnimationBack","otherProps","isOpenRef","defaultLevels","levels","setLevels","setSubMenuDirection","hoveredParenLevel","setHoveredParenLevel","levelsRefs","length","addLevel","level","activeItem","parent","newLevels","oldDirection","splice","push","current","deleteLevel","isActive","ignoreClicksInsideRefs","handler","map","index","key","last","animate","zIndex","onSetDirection","el"],"sources":["../../../../../../src/components/ContextMenu/ContextMenuLevels/ContextMenuLevels.tsx"],"sourcesContent":["import React, { Fragment, useEffect, useState } from 'react';\nimport { Transition, TransitionGroup } from 'react-transition-group';\n\nimport { Direction } from '##/components/Popover';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { animateTimeout } from '##/mixs/MixPopoverAnimate';\nimport { setRef } from '##/utils/setRef';\n\nimport { clearTimers, ContextMenuLevel } from '../ContextMenuLevel';\nimport { getLevels, withDefaultGetters } from '../helpers';\nimport {\n  AddLevel,\n  ContextMenuItemDefault,\n  ContextMenuLevelsProps,\n  contextMenuPropDefaultSubMenuDirection,\n  contextMenuPropSubMenuDirections,\n  Level,\n} from '../types';\nimport { useSize } from './useSize';\n\nexport const ContextMenuLevels = (propsComponent: ContextMenuLevelsProps) => {\n  const props = withDefaultGetters(propsComponent);\n  const {\n    items,\n    anchorRef,\n    position,\n    direction,\n    possibleDirections,\n    offset,\n    onClickOutside,\n    getItemKey,\n    getItemLabel,\n    getItemSubMenu,\n    style,\n    spareDirection,\n    subMenuDirection:\n      subMenuDirectionProp = contextMenuPropDefaultSubMenuDirection,\n    isMobile,\n    isOpen,\n    setComponentSize,\n    enableAnimationBack,\n    disableAnimationBack,\n    ...otherProps\n  } = props;\n\n  const isOpenRef = useMutableRef(isOpen);\n\n  type Item = typeof items[number];\n\n  const defaultLevels: Level<ContextMenuItemDefault>[] = [\n    {\n      items,\n      anchorRef,\n      position,\n      direction,\n      possibleDirections,\n      offset,\n    },\n  ];\n\n  const [levels, setLevels] = useState<\n    Level<ContextMenuItemDefault & { isParent?: boolean }>[]\n  >(isMobile ? defaultLevels : []);\n  const [subMenuDirection, setSubMenuDirection] =\n    useState<Direction>(subMenuDirectionProp);\n  const [hoveredParenLevel, setHoveredParenLevel] = useState<number>(-1);\n\n  const levelsRefs = useRefs<HTMLDivElement>(levels.length);\n\n  const addLevel: AddLevel<Item> = ({\n    level,\n    items,\n    anchorRef,\n    activeItem,\n    parent,\n  }) => {\n    const newLevels: Level<ContextMenuItemDefault & { isParent?: boolean }>[] =\n      [...levels];\n    const oldDirection =\n      newLevels[level] && newLevels.length - level > 1\n        ? newLevels[level].direction\n        : undefined;\n\n    if (newLevels[level] && newLevels.length - level > 1 && oldDirection) {\n      setSubMenuDirection(oldDirection);\n    }\n\n    newLevels[level - 1].activeItem = activeItem;\n    newLevels.splice(level);\n    newLevels.push({\n      items,\n      anchorRef: isMobile ? props.anchorRef : anchorRef,\n      direction: isMobile ? props.direction : oldDirection || subMenuDirection,\n      possibleDirections: isMobile\n        ? props.possibleDirections\n        : contextMenuPropSubMenuDirections,\n      position: isMobile ? props.position : undefined,\n      offset: isMobile ? props.offset : undefined,\n      parent,\n    });\n\n    isOpenRef.current ? setLevels(newLevels) : setLevels([]);\n  };\n\n  const deleteLevel = (level: number) => {\n    if (level > 0) {\n      enableAnimationBack();\n      const newLevels = [...levels];\n      newLevels.splice(level);\n      newLevels[level - 1] = { ...newLevels[level - 1], activeItem: undefined };\n      setLevels(newLevels);\n      disableAnimationBack();\n    }\n  };\n\n  useClickOutside({\n    isActive: onClickOutside && isOpen,\n    ignoreClicksInsideRefs: [...levelsRefs, anchorRef || { current: null }],\n    handler: onClickOutside,\n  });\n\n  useEffect(() => {\n    clearTimers();\n    setLevels(\n      getLevels({\n        levels,\n        items,\n        getItemKey,\n        getItemSubMenu,\n      }),\n    );\n    return () => clearTimers();\n  }, [items]);\n\n  useEffect(() => {\n    setLevels(defaultLevels);\n  }, [position]);\n\n  useEffect(() => {\n    setLevels(isOpen ? defaultLevels : []);\n  }, [isOpen]);\n\n  useSize(levelsRefs, setComponentSize, isMobile);\n\n  return (\n    <TransitionGroup component={Fragment}>\n      {levels.map((level, index) => {\n        const key = `${index}-${level.parent ? getItemKey(level.parent) : ''}`;\n\n        const last = index !== levels.length - 1;\n\n        if (isMobile && last) {\n          return <Fragment key={index} />;\n        }\n\n        return (\n          <Transition\n            key={key}\n            timeout={animateTimeout}\n            nodeRef={levelsRefs[index]}\n          >\n            {(animate) => (\n              <ContextMenuLevel\n                {...otherProps}\n                {...level}\n                key={`${index}-${level.parent ? getItemKey(level.parent) : ''}`}\n                isMobile={isMobile}\n                isOpen={isOpen}\n                style={{\n                  ...style,\n                  ...{\n                    zIndex:\n                      typeof style?.zIndex === 'number'\n                        ? style.zIndex + 1\n                        : undefined,\n                  },\n                }}\n                activeLevelDepth={levels.length - 1}\n                levelDepth={index}\n                getItemLabel={getItemLabel}\n                addLevel={addLevel}\n                deleteLevel={deleteLevel}\n                onSetDirection={\n                  index > 0 ? setSubMenuDirection : props.onSetDirection\n                }\n                hoveredParenLevel={hoveredParenLevel}\n                setHoveredParenLevel={setHoveredParenLevel}\n                getItemSubMenu={getItemSubMenu}\n                getItemKey={getItemKey}\n                ref={(el) => setRef(levelsRefs[index], el)}\n                spareDirection={index === 0 ? spareDirection : 'rightStartUp'}\n                parent={isMobile ? level.parent : undefined}\n                animate={animate}\n              />\n            )}\n          </Transition>\n        );\n      })}\n    </TransitionGroup>\n  );\n};\n"],"mappings":"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"}