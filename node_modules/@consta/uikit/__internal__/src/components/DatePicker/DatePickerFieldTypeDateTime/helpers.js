import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import{format as _format,isValid,isWithinInterval,parse as _parse}from"date-fns";import{useCallback,useMemo}from"react";import{useIMask}from"react-imask";import{getTimeOptionsKey}from"../../DateTime/helpers/getTimeOptionsKey";import{useMutableRef}from"../../../hooks/useMutableRef/useMutableRef";import{datePickerPropSeparatorDefault,getMaskBlocks,getPartDate,getParts,getPartsDate,isValidTimeByTimeOptions,useStringValue}from"../helpers";import{datePickerErrorTypes}from"../types";export var usePicker=function(a){var b=a.value,c=a.onChange,d=a.onError,f=a.format,g=a.separator,h=a.maxDate,i=a.minDate,j=a.timeOptions,k=useMutableRef(c),l=useMutableRef(b),m=useMutableRef(d),n=useCallback(function(a,b,c){var d=k.current,e=l.current;if(!(e&&isValid(e)&&_format(e,f)===a)){if((null===a||void 0===a?void 0:a.length)!==f.length&&e&&c&&d)return void d(null,{e:c});if(d&&c){if(!a)return void(e&&d(null,{e:c}));var n=getParts(f,g,!1),o=getParts(a,g,!1),p=n.map(function(a){return getPartDate(n,o,a)}).filter(function(a){return!!a});if(n.length===p.length){var F=_parse(o.join(datePickerPropSeparatorDefault),n.join(datePickerPropSeparatorDefault),new Date);if(!isWithinInterval(F,{start:i,end:h})){var q,r=getPartsDate(a,f,g,!0,["dd","MM","yyyy","HH","mm","ss"]),s=_slicedToArray(r,6),t=s[0],u=s[1],v=s[2],w=s[3],x=s[4],y=s[5];return null===(q=m.current)||void 0===q?void 0:q.call(m,{type:datePickerErrorTypes[0],stringValue:a,dd:t,MM:u,yyyy:v,date:F,HH:w,mm:x,ss:y}),void(e&&d(null,{e:c}))}if(!isValidTimeByTimeOptions(F,j)){var z,A=getPartsDate(a,f,":",!1,["HH","mm","ss"]),B=_slicedToArray(A,3),C=B[0],D=B[1],E=B[2];return null===(z=m.current)||void 0===z?void 0:z.call(m,{type:datePickerErrorTypes[3],stringValue:a,date:F,HH:C,mm:D,ss:E}),void(e&&d(null,{e:c}))}d(F,{e:c})}else e&&d(null,{e:c})}}},[null===i||void 0===i?void 0:i.getTime(),null===h||void 0===h?void 0:h.getTime(),f,g,getTimeOptionsKey(j)]),o=useMemo(function(){return getMaskBlocks()},[]),p=useIMask({mask:Date,pattern:f,blocks:{yyyy:o.yyyy,MM:o.MM,dd:o.dd,HH:o.HH,mm:o.mm,ss:o.ss},lazy:!0,autofix:!0,format:function format(a){return _format(a,f)},parse:function parse(a){return _parse(a,f,new Date)},validate:function validate(a){var b=getParts(f,g,!1),c=getParts(a,g,!1),d=b.map(function(a){return getPartDate(b,c,a)}).filter(function(a){return!!a});if(b.length===d.length&&!isValid(_parse(c.join(datePickerPropSeparatorDefault),b.join(datePickerPropSeparatorDefault),new Date))){var e,h=getPartsDate(a,f,g,!0,["dd","MM","yyyy","HH","mm","ss"]),i=_slicedToArray(h,6),j=i[0],k=i[1],l=i[2],n=i[3],o=i[4],p=i[5];return null===(e=m.current)||void 0===e?void 0:e.call(m,{type:datePickerErrorTypes[1],stringValue:a,dd:j,MM:k,yyyy:l,HH:n,mm:o,ss:p}),!1}return!0}},{onAccept:n}),q=useStringValue(b,f,g,k,p);return[p.ref,q]};
//# sourceMappingURL=helpers.js.map