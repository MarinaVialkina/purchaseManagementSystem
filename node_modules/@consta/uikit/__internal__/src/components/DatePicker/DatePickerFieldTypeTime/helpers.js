import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import{format as _format,isValid,isWithinInterval,parse as _parse}from"date-fns";import{useCallback,useMemo}from"react";import{useIMask}from"react-imask";import{getTimeOptionsKey}from"../../DateTime/helpers/getTimeOptionsKey";import{useMutableRef}from"../../../hooks/useMutableRef";import{getMaskBlocks,getPartDate,getParts,getPartsDate,isValidTimeByTimeOptions,useStringValue}from"../helpers";import{datePickerErrorTypes}from"../types";export var usePicker=function(a){var b=a.value,c=a.onChange,d=a.onError,f=a.timeOptions,g=a.format,h=a.separator,i=a.maxDate,j=a.minDate,k=useMutableRef(c),l=useMutableRef(b),m=useMutableRef(d),n=useCallback(function(a,b,c){var d=k.current,e=l.current;if(!(e&&isValid(e)&&_format(e,g)===a)){if((null===a||void 0===a?void 0:a.length)!==g.length&&e&&c&&d)return void d(null,{e:c});if(d&&c){if(!a)return void(e&&d(null,{e:c}));var n=getParts(g,h,!1),o=getParts(a,h,!1),p=n.map(function(a){return getPartDate(n,o,a)}).filter(function(a){return!!a});if(n.length===p.length){var C=_parse(o.join(":"),n.join(":"),e||new Date);if(!isWithinInterval(C,{start:j,end:i})){var q,r=getPartsDate(a,g,":",!1,["HH","mm","ss"]),s=_slicedToArray(r,3),t=s[0],u=s[1],v=s[2];return null===(q=m.current)||void 0===q?void 0:q.call(m,{type:datePickerErrorTypes[0],stringValue:a,date:C,HH:t,mm:u,ss:v}),void(e&&d(null,{e:c}))}if(!isValidTimeByTimeOptions(C,f)){var w,x=getPartsDate(a,g,":",!1,["HH","mm","ss"]),y=_slicedToArray(x,3),z=y[0],A=y[1],B=y[2];return null===(w=m.current)||void 0===w?void 0:w.call(m,{type:datePickerErrorTypes[3],stringValue:a,date:C,HH:z,mm:A,ss:B}),void(e&&d(null,{e:c}))}d(C,{e:c})}else e&&d(null,{e:c})}}},[null===j||void 0===j?void 0:j.getTime(),null===i||void 0===i?void 0:i.getTime(),g,h,getTimeOptionsKey(f)]),o=useMemo(function(){return getMaskBlocks({includeDate:!1})},[]),p=useIMask({mask:Date,pattern:g,blocks:{HH:o.HH,mm:o.mm,ss:o.ss},lazy:!0,autofix:!0,format:function format(a){return _format(a,g)},parse:function parse(a){return _parse(a,g,new Date)},validate:function validate(a){var b=getParts(g,h,!1),c=getParts(a,h,!1),d=b.map(function(a){return getPartDate(b,c,a)}).filter(function(a){return!!a});if(b.length===d.length&&!isValid(_parse(c.join(":"),b.join(":"),new Date))){var e,f=getPartsDate(a,g,":",!1,["HH","mm","ss"]),i=_slicedToArray(f,3),j=i[0],k=i[1],l=i[2];return null===(e=m.current)||void 0===e?void 0:e.call(m,{type:datePickerErrorTypes[1],stringValue:a,HH:j,mm:k,ss:l}),!1}return!0}},{onAccept:n}),q=useStringValue(b,g,h,k,p);return[p.ref,q]};
//# sourceMappingURL=helpers.js.map