{"version":3,"file":"FieldArrayValueInlineControl.js","names":["useAction","useAtom","useUpdate","React","forwardRef","useRef","useComponentSize","useForkRef","usePropAtom","useSendToAtom","withCtx","useCreateAtom","cnFieldArrayValueInlineControl","gapMap","l","m","s","xs","verticalPaddingMap","inputHeightMap","InputFakeElement","componentRef","valueAtom","inputMinWidthAtom","otherProps","value","ref","width","ctx","Root","children","className","size","style","inputMinWidth","FieldArrayValueInlineControlRender","props","inputRefProp","inputRef","inputMaxLength","inputMinLength","inputValue","inputDefaultValue","renderValue","onFocus","onBlur","autoFocus","inputTabIndex","inputAriaLabel","disabled","placeholder","onKeyDown","onKeyDownCapture","onChange","onKeyUp","onKeyUpCapture","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onWheel","disableInput","propsAtom","inputValuePropAtom","inputValueAtom","inputDefaultValueAtom","fakeInputRef","handleChange","e","target","get","inputValueProp","spy","current","length","FieldArrayValueInlineControl"],"sources":["../../../../../../src/components/FieldComponents/FieldArrayValueInlineControl/FieldArrayValueInlineControl.tsx"],"sourcesContent":["import { AtomMut } from '@reatom/framework';\nimport { useAction, useAtom, useUpdate } from '@reatom/npm-react';\nimport React, { forwardRef, useRef } from 'react';\n\nimport { useComponentSize } from '##/hooks/useComponentSize';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { usePropAtom, useSendToAtom, withCtx } from '##/utils/state';\nimport { useCreateAtom } from '##/utils/state/useCreateAtom';\nimport { PropsWithHTMLAttributes } from '##/utils/types/PropsWithHTMLAttributes';\n\nimport { FieldPropSize } from '../types';\nimport { cnFieldArrayValueInlineControl } from './cnFieldArrayValueInlineControl';\nimport {\n  FieldArrayValueInlineControlComponent,\n  FieldArrayValueInlineControlProps,\n} from './types';\n\nconst gapMap: Record<FieldPropSize, string> = {\n  l: 'calc(var(--space-3xs) + var(--space-2xs))',\n  m: 'var(--space-2xs)',\n  s: 'var(--space-3xs)',\n  xs: 'var(--space-3xs)',\n};\n\nconst verticalPaddingMap: Record<FieldPropSize, string> = {\n  l: 'var(--space-xs)',\n  m: 'calc(var(--space-xs) - var(--space-3xs))',\n  s: 'var(--space-2xs)',\n  xs: 'var(--space-3xs)',\n};\n\nconst inputHeightMap: Record<FieldPropSize, string> = {\n  l: 'var(--space-2xl)',\n  m: 'calc(var(--space-2xl) - var(--space-2xs))',\n  s: 'var(--space-xl)',\n  xs: 'var(--space-l)',\n};\n\nconst InputFakeElement = forwardRef<\n  HTMLDivElement,\n  PropsWithHTMLAttributes<\n    {\n      valueAtom: AtomMut<string | undefined>;\n      inputMinWidthAtom: AtomMut<number>;\n    },\n    HTMLDivElement\n  >\n>(({ valueAtom, inputMinWidthAtom, ...otherProps }, componentRef) => {\n  const [value] = useAtom(valueAtom);\n\n  const ref = useRef<HTMLDivElement>(null);\n\n  const { width } = useComponentSize(ref);\n\n  useUpdate(\n    (ctx, width) => {\n      inputMinWidthAtom(ctx, width);\n    },\n    [width],\n  );\n\n  return (\n    <div {...otherProps} ref={useForkRef([componentRef, ref])}>\n      {value}\n    </div>\n  );\n});\n\nconst Root = forwardRef<\n  HTMLDivElement,\n  PropsWithHTMLAttributes<\n    {\n      inputMinWidthAtom: AtomMut<number>;\n      size: FieldArrayValueInlineControlProps<unknown>['size'];\n    },\n    HTMLDivElement\n  >\n>(\n  (\n    {\n      children,\n      className,\n      inputMinWidthAtom,\n      size = 'm',\n      style,\n      ...otherProps\n    },\n    ref,\n  ) => {\n    const [inputMinWidth] = useAtom(inputMinWidthAtom);\n\n    return (\n      <div\n        {...otherProps}\n        className={cnFieldArrayValueInlineControl(null, [className])}\n        ref={ref}\n        style={{\n          ...style,\n          ['--field-array-value-inline-control-items-gap' as string]:\n            gapMap[size],\n          ['--field-array-value-inline-control-input-min-width' as string]: `${inputMinWidth}px`,\n          ['--field-array-value-inline-control-vertical-padding' as string]: `${verticalPaddingMap[size]}`,\n          ['--field-array-value-inline-control-input-height' as string]: `${inputHeightMap[size]}`,\n        }}\n      >\n        {children}\n      </div>\n    );\n  },\n);\n\nconst FieldArrayValueInlineControlRender = (\n  props: FieldArrayValueInlineControlProps<unknown>,\n  ref: React.Ref<HTMLDivElement>,\n) => {\n  const {\n    className,\n    inputRef: inputRefProp,\n    inputMaxLength,\n    inputMinLength,\n    value = [],\n    inputValue,\n    inputDefaultValue = '',\n    renderValue,\n    onFocus,\n    onBlur,\n    autoFocus,\n    inputTabIndex,\n    inputAriaLabel,\n    disabled,\n    size = 'm',\n    placeholder,\n    onKeyDown,\n    onKeyDownCapture,\n    onChange,\n    onKeyUp,\n    onKeyUpCapture,\n    onCopy,\n    onCopyCapture,\n    onCut,\n    onCutCapture,\n    onPaste,\n    onPasteCapture,\n    onWheel,\n    disableInput,\n    ...otherProps\n  } = props;\n\n  const propsAtom = useSendToAtom(props);\n  const inputValuePropAtom = usePropAtom(propsAtom, 'inputValue');\n  // const valueAtom = usePropAtom(propsAtom, 'value');\n  const inputValueAtom = useCreateAtom<string | undefined>(\n    inputValue || inputDefaultValue,\n  );\n  const inputDefaultValueAtom = useCreateAtom(inputDefaultValue);\n  const inputMinWidthAtom = useCreateAtom(0);\n\n  const fakeInputRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const handleChange = useAction(\n    (ctx, e: React.ChangeEvent<HTMLInputElement>) => {\n      inputValueAtom(ctx, e.target.value);\n      const { onChange } = ctx.get(propsAtom);\n      if (onChange) {\n        onChange(e);\n      }\n    },\n    [],\n  );\n\n  useAtom((ctx) => {\n    const inputValueProp = ctx.spy(inputValuePropAtom);\n    const inputDefaultValue = ctx.get(inputDefaultValueAtom);\n    if (inputDefaultValue) {\n      inputDefaultValueAtom(ctx, '');\n    } else {\n      if (inputRef.current) {\n        inputRef.current.value = inputValueProp || '';\n      }\n\n      inputValueAtom(ctx, inputValueProp);\n    }\n  });\n\n  return (\n    <Root\n      {...otherProps}\n      className={cnFieldArrayValueInlineControl(null, [className])}\n      ref={ref}\n      size={size}\n      inputMinWidthAtom={inputMinWidthAtom}\n    >\n      {renderValue(value || [])}\n      <input\n        className={cnFieldArrayValueInlineControl('Input', {\n          disabled: disableInput,\n        })}\n        onChange={handleChange}\n        ref={useForkRef([inputRef, inputRefProp])}\n        maxLength={inputMaxLength}\n        onFocus={onFocus}\n        onBlur={onBlur}\n        // eslint-disable-next-line jsx-a11y/no-autofocus\n        autoFocus={autoFocus}\n        tabIndex={inputTabIndex}\n        aria-label={inputAriaLabel}\n        onKeyDown={onKeyDown}\n        onKeyDownCapture={onKeyDownCapture}\n        onKeyUp={onKeyUp}\n        onKeyUpCapture={onKeyUpCapture}\n        disabled={disabled}\n        type=\"text\"\n        placeholder={value.length ? undefined : placeholder}\n        onCopy={onCopy}\n        onCopyCapture={onCopyCapture}\n        onCut={onCut}\n        onCutCapture={onCutCapture}\n        onPaste={onPaste}\n        onPasteCapture={onPasteCapture}\n        onWheel={onWheel}\n        defaultValue={inputDefaultValue}\n        readOnly={disableInput}\n      />\n      <InputFakeElement\n        ref={fakeInputRef}\n        className={cnFieldArrayValueInlineControl('HelperInputFakeElement')}\n        valueAtom={inputValueAtom}\n        inputMinWidthAtom={inputMinWidthAtom}\n      />\n    </Root>\n  );\n};\n\nexport const FieldArrayValueInlineControl = withCtx(\n  forwardRef(FieldArrayValueInlineControlRender),\n) as FieldArrayValueInlineControlComponent;\n"],"mappings":"wzCACA,OAASA,SAAT,CAAoBC,OAApB,CAA6BC,SAA7B,KAA8C,mBAA9C,CACA,MAAOC,MAAP,EAAgBC,UAAhB,CAA4BC,MAA5B,KAA0C,OAA1C,CAEA,OAASC,gBAAT,uCACA,OAASC,UAAT,iCACA,OAASC,WAAT,CAAsBC,aAAtB,CAAqCC,OAArC,4BACA,OAASC,aAAT,0CAIA,OAASC,8BAAT,wC,GAMMC,OAAqC,CAAG,CAC5CC,CAAC,CAAE,2CADyC,CAE5CC,CAAC,CAAE,kBAFyC,CAG5CC,CAAC,CAAE,kBAHyC,CAI5CC,EAAE,CAAE,kBAJwC,C,CAOxCC,kBAAiD,CAAG,CACxDJ,CAAC,CAAE,iBADqD,CAExDC,CAAC,CAAE,0CAFqD,CAGxDC,CAAC,CAAE,kBAHqD,CAIxDC,EAAE,CAAE,kBAJoD,C,CAOpDE,cAA6C,CAAG,CACpDL,CAAC,CAAE,kBADiD,CAEpDC,CAAC,CAAE,2CAFiD,CAGpDC,CAAC,CAAE,iBAHiD,CAIpDC,EAAE,CAAE,gBAJgD,C,CAOhDG,gBAAgB,CAAGhB,UAAU,CASjC,WAAkDiB,CAAlD,CAAmE,IAAhEC,EAAgE,GAAhEA,SAAgE,CAArDC,CAAqD,GAArDA,iBAAqD,CAA/BC,CAA+B,yCACnDvB,OAAO,CAACqB,CAAD,CAD4C,uBAC5DG,CAD4D,MAG7DC,CAAG,CAAGrB,MAAM,CAAiB,IAAjB,CAHiD,GAKjDC,gBAAgB,CAACoB,CAAD,CALiC,CAK3DC,CAL2D,GAK3DA,KAL2D,CAcnE,MAPAzB,UAAS,CACP,SAAC0B,CAAD,CAAMD,CAAN,CAAgB,CACdJ,CAAiB,CAACK,CAAD,CAAMD,CAAN,CAClB,CAHM,CAIP,CAACA,CAAD,CAJO,CAOT,CACE,2CAASH,CAAT,EAAqB,GAAG,CAAEjB,UAAU,CAAC,CAACc,CAAD,CAAeK,CAAf,CAAD,CAApC,GACGD,CADH,CAIH,CA5BkC,C,CA8B7BI,IAAI,CAAGzB,UAAU,CAUrB,WASEsB,CATF,CAUK,OARDI,CAQC,GARDA,QAQC,CAPDC,CAOC,GAPDA,SAOC,CANDR,CAMC,GANDA,iBAMC,KALDS,IAKC,CALDA,CAKC,YALM,GAKN,GAJDC,CAIC,GAJDA,KAIC,CAHET,CAGF,0CACqBvB,OAAO,CAACsB,CAAD,CAD5B,uBACIW,CADJ,MAGH,MACE,4CACMV,CADN,EAEE,SAAS,CAAEZ,8BAA8B,CAAC,IAAD,CAAO,CAACmB,CAAD,CAAP,CAF3C,CAGE,GAAG,CAAEL,CAHP,CAIE,KAAK,gCACAO,CADA,6BAEF,8CAFE,CAGDpB,MAAM,CAACmB,CAAD,CAHL,oBAIF,oDAJE,WAIkEE,CAJlE,0BAKF,qDALE,WAKmEhB,kBAAkB,CAACc,CAAD,CALrF,qBAMF,iDANE,WAM+Db,cAAc,CAACa,CAAD,CAN7E,MAJP,GAaGF,CAbH,CAgBH,CAxCoB,C,CA2CjBK,kCAAkC,CAAG,SACzCC,CADyC,CAEzCV,CAFyC,CAGtC,IAEDK,EAFC,CAgCCK,CAhCD,CAEDL,SAFC,CAGSM,CAHT,CAgCCD,CAhCD,CAGDE,QAHC,CAIDC,CAJC,CAgCCH,CAhCD,CAIDG,cAJC,CAKDC,CALC,CAgCCJ,CAhCD,CAKDI,cALC,GAgCCJ,CAhCD,CAMDX,KANC,CAMDA,CANC,YAMO,EANP,GAODgB,CAPC,CAgCCL,CAhCD,CAODK,UAPC,GAgCCL,CAhCD,CAQDM,iBARC,CAQDA,CARC,YAQmB,EARnB,GASDC,CATC,CAgCCP,CAhCD,CASDO,WATC,CAUDC,CAVC,CAgCCR,CAhCD,CAUDQ,OAVC,CAWDC,CAXC,CAgCCT,CAhCD,CAWDS,MAXC,CAYDC,CAZC,CAgCCV,CAhCD,CAYDU,SAZC,CAaDC,CAbC,CAgCCX,CAhCD,CAaDW,aAbC,CAcDC,CAdC,CAgCCZ,CAhCD,CAcDY,cAdC,CAeDC,CAfC,CAgCCb,CAhCD,CAeDa,QAfC,GAgCCb,CAhCD,CAgBDJ,IAhBC,CAgBDA,CAhBC,YAgBM,GAhBN,GAiBDkB,CAjBC,CAgCCd,CAhCD,CAiBDc,WAjBC,CAkBDC,CAlBC,CAgCCf,CAhCD,CAkBDe,SAlBC,CAmBDC,CAnBC,CAgCChB,CAhCD,CAmBDgB,gBAnBC,CAoBDC,CApBC,CAgCCjB,CAhCD,CAoBDiB,QApBC,CAqBDC,CArBC,CAgCClB,CAhCD,CAqBDkB,OArBC,CAsBDC,CAtBC,CAgCCnB,CAhCD,CAsBDmB,cAtBC,CAuBDC,CAvBC,CAgCCpB,CAhCD,CAuBDoB,MAvBC,CAwBDC,CAxBC,CAgCCrB,CAhCD,CAwBDqB,aAxBC,CAyBDC,CAzBC,CAgCCtB,CAhCD,CAyBDsB,KAzBC,CA0BDC,CA1BC,CAgCCvB,CAhCD,CA0BDuB,YA1BC,CA2BDC,CA3BC,CAgCCxB,CAhCD,CA2BDwB,OA3BC,CA4BDC,CA5BC,CAgCCzB,CAhCD,CA4BDyB,cA5BC,CA6BDC,CA7BC,CAgCC1B,CAhCD,CA6BD0B,OA7BC,CA8BDC,CA9BC,CAgCC3B,CAhCD,CA8BD2B,YA9BC,CA+BEvC,CA/BF,0BAgCCY,CAhCD,aAkCG4B,CAAS,CAAGvD,aAAa,CAAC2B,CAAD,CAlC5B,CAmCG6B,CAAkB,CAAGzD,WAAW,CAACwD,CAAD,CAAY,YAAZ,CAnCnC,CAqCGE,CAAc,CAAGvD,aAAa,CAClC8B,CAAU,EAAIC,CADoB,CArCjC,CAwCGyB,CAAqB,CAAGxD,aAAa,CAAC+B,CAAD,CAxCxC,CAyCGnB,CAAiB,CAAGZ,aAAa,CAAC,CAAD,CAzCpC,CA2CGyD,CAAY,CAAG/D,MAAM,CAAiB,IAAjB,CA3CxB,CA4CGiC,CAAQ,CAAGjC,MAAM,CAAmB,IAAnB,CA5CpB,CA6CGgE,CAAY,CAAGrE,SAAS,CAC5B,SAAC4B,CAAD,CAAM0C,CAAN,CAAiD,CAC/CJ,CAAc,CAACtC,CAAD,CAAM0C,CAAC,CAACC,MAAF,CAAS9C,KAAf,CADiC,CAE/C,MAAqBG,CAAG,CAAC4C,GAAJ,CAAQR,CAAR,CAArB,CAAQX,CAAR,GAAQA,QAAR,CACIA,CAH2C,EAI7CA,CAAQ,CAACiB,CAAD,CAEX,CAP2B,CAQ5B,EAR4B,CA7C3B,CAsEH,MAdArE,QAAO,CAAC,SAAC2B,CAAD,CAAS,IACT6C,EAAc,CAAG7C,CAAG,CAAC8C,GAAJ,CAAQT,CAAR,CADR,CAETvB,CAAiB,CAAGd,CAAG,CAAC4C,GAAJ,CAAQL,CAAR,CAFX,CAGXzB,CAHW,CAIbyB,CAAqB,CAACvC,CAAD,CAAM,EAAN,CAJR,EAMTU,CAAQ,CAACqC,OANA,GAOXrC,CAAQ,CAACqC,OAAT,CAAiBlD,KAAjB,CAAyBgD,CAAc,EAAI,EAPhC,EAUbP,CAAc,CAACtC,CAAD,CAAM6C,CAAN,CAVD,CAYhB,CAZM,CAcP,CACE,oBAAC,IAAD,kBACMjD,CADN,EAEE,SAAS,CAAEZ,8BAA8B,CAAC,IAAD,CAAO,CAACmB,CAAD,CAAP,CAF3C,CAGE,GAAG,CAAEL,CAHP,CAIE,IAAI,CAAEM,CAJR,CAKE,iBAAiB,CAAET,CALrB,GAOGoB,CAAW,CAAClB,CAAK,EAAI,EAAV,CAPd,CAQE,6BACE,SAAS,CAAEb,8BAA8B,CAAC,OAAD,CAAU,CACjDqC,QAAQ,CAAEc,CADuC,CAAV,CAD3C,CAIE,QAAQ,CAAEM,CAJZ,CAKE,GAAG,CAAE9D,UAAU,CAAC,CAAC+B,CAAD,CAAWD,CAAX,CAAD,CALjB,CAME,SAAS,CAAEE,CANb,CAOE,OAAO,CAAEK,CAPX,CAQE,MAAM,CAAEC,CARV,CAUE,SAAS,CAAEC,CAVb,CAWE,QAAQ,CAAEC,CAXZ,CAYE,aAAYC,CAZd,CAaE,SAAS,CAAEG,CAbb,CAcE,gBAAgB,CAAEC,CAdpB,CAeE,OAAO,CAAEE,CAfX,CAgBE,cAAc,CAAEC,CAhBlB,CAiBE,QAAQ,CAAEN,CAjBZ,CAkBE,IAAI,CAAC,MAlBP,CAmBE,WAAW,CAAExB,CAAK,CAACmD,MAAN,QAA2B1B,CAnB1C,CAoBE,MAAM,CAAEM,CApBV,CAqBE,aAAa,CAAEC,CArBjB,CAsBE,KAAK,CAAEC,CAtBT,CAuBE,YAAY,CAAEC,CAvBhB,CAwBE,OAAO,CAAEC,CAxBX,CAyBE,cAAc,CAAEC,CAzBlB,CA0BE,OAAO,CAAEC,CA1BX,CA2BE,YAAY,CAAEpB,CA3BhB,CA4BE,QAAQ,CAAEqB,CA5BZ,EARF,CAsCE,oBAAC,gBAAD,EACE,GAAG,CAAEK,CADP,CAEE,SAAS,CAAExD,8BAA8B,CAAC,wBAAD,CAF3C,CAGE,SAAS,CAAEsD,CAHb,CAIE,iBAAiB,CAAE3C,CAJrB,EAtCF,CA8CH,C,CAED,MAAO,IAAMsD,6BAA4B,CAAGnE,OAAO,CACjDN,UAAU,CAAC+B,kCAAD,CADuC,CAA5C"}