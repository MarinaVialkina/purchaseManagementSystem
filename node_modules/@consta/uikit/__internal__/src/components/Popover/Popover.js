import _defineProperty from"@babel/runtime/helpers/defineProperty";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["children","direction","offset","arrowOffset","possibleDirections","isInteractive","onClickOutside","spareDirection","style","className","position","anchorRef","equalAnchorWidth","onSetDirection","viewportRef","container"];function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}import"./Popover.css";import React,{forwardRef,useEffect,useLayoutEffect,useMemo}from"react";import{PortalWithTheme,PortalWithThemeConsumer}from"../PortalWithTheme";import{useTheme}from"../Theme/Theme";import{useComponentSize}from"../../hooks/useComponentSize";import{useForkRef}from"../../hooks/useForkRef";import{cn}from"../../utils/bem";import{isRenderProp}from"../../utils/isRenderProp";import{isNumber,isString}from"../../utils/type-guards";import{getComputedPositionAndDirection,getPointPosition,getRenderPosition}from"./helpers";import{usePopoverReposition}from"./usePopoverReposition";export var directionsStartCenter=["downCenter","upCenter","downRight","downLeft","upRight","upLeft","leftUp","leftCenter","leftDown","rightUp","rightCenter","rightDown"];export var directionsStartEdge=["downStartLeft","upStartLeft","downStartRight","upStartRight","leftStartUp","leftStartDown","rightStartUp","rightStartDown"];export var popoverPropOffset=["3xs","2xs","xs","s","m","l","xl","2xl","3xl","4xl","5xl","6xl"];export var directions=[].concat(directionsStartCenter,directionsStartEdge);var getOffset=function(a,b){if(isNumber(b))return b;if(isString(b)&&a.current){var g=getComputedStyle(a.current).getPropertyValue("--space-".concat(b));if(g&&/px$/.test(g))return+g.slice(0,g.length-2);if(g&&/rem$/.test(g)){var c=parseFloat(getComputedStyle(document.documentElement).fontSize),d=+g.slice(0,g.length-3);return c*d}if(g&&/em$/.test(g)){var e=parseFloat(getComputedStyle(a.current).fontSize),f=+g.slice(0,g.length-2);return e*f}return 0}return 0},cnPopover=cn("Popover");export var Popover=forwardRef(function(a,b){var c,d=a.children,e=a.direction,f=void 0===e?"upCenter":e,g=a.offset,h=void 0===g?0:g,i=a.arrowOffset,j=a.possibleDirections,k=void 0===j?directions:j,l=a.isInteractive,m=a.onClickOutside,n=a.spareDirection,o=void 0===n?"downStartLeft":n,p=a.style,q=a.className,r=a.position,s=a.anchorRef,t=a.equalAnchorWidth,u=a.onSetDirection,v=a.viewportRef,w=a.container,x=void 0===w?window.document.body:w,y=_objectWithoutProperties(a,_excluded),z=(null===v||void 0===v?void 0:v.current)||document.documentElement,A=React.useRef(null),B=useTheme(),C=B.theme,D=React.useState(),E=_slicedToArray(D,2),F=E[0],G=E[1],H=useComponentSize(A),I=H.width,J=H.height,K=useComponentSize(s||{current:null}),L=React.useRef(null),M=React.useState([]),N=_slicedToArray(M,2),O=N[0],P=N[1],Q=function(){P(function(a){return a.length?[]:a}),L.current=null},R=function(){var a;return G(null===s||void 0===s||null===(a=s.current)||void 0===a?void 0:a.getBoundingClientRect())},S=useMemo(function(){return getOffset(A,h)},[h,!!A.current]),T=getComputedPositionAndDirection({contentSize:{width:I,height:J},viewportSize:{width:z.clientWidth,height:z.clientHeight},arrowOffset:i,offset:S,direction:f,possibleDirections:k,bannedDirections:O,position:getPointPosition(z,F?{x:F.left,y:F.top}:r,!!(null!==v&&void 0!==v&&v.current)),anchorSize:K,spareDirection:o}),U=T.position,V=T.direction;useEffect(function(){return null===u||void 0===u?void 0:u(V)},[V]),useEffect(R,[K]),usePopoverReposition({isActive:!0,scrollAnchorRef:s||{current:null},onRequestReposition:function onRequestReposition(){Q(),R()}}),useLayoutEffect(function(){L.current!==V&&(L.current&&!O.includes(L.current)&&!O.includes(V)&&V!==o&&P(function(a){return L.current?[].concat(_toConsumableArray(a),[L.current]):a}),L.current=V)},[V]),useLayoutEffect(Q,[a]);var W=getRenderPosition(z,U,!!(null!==v&&void 0!==v&&v.current),I,J),X=!W||!J||!I;return React.createElement(PortalWithTheme,Object.assign({},y,{preset:C,className:cnPopover({direction:V,notVisible:X},[q]),container:x,ref:useForkRef([A,b]),style:_objectSpread(_objectSpread({},p),X?{}:(c={},_defineProperty(c,"--popover-left","".concat(W.x,"px")),_defineProperty(c,"--popover-top","".concat(W.y,"px")),_defineProperty(c,"--popover-width",t?"".concat(K.width,"px"):void 0),_defineProperty(c,"--popover-pointer-events",!(void 0!==l)||l?void 0:"none"),_defineProperty(c,"--popover-visibility",U?void 0:"hidden"),c))}),React.createElement(PortalWithThemeConsumer,{onClickOutside:m,ignoreClicksInsideRefs:[A,s||{current:null}]},isRenderProp(d)?d(V):d))});
//# sourceMappingURL=Popover.js.map