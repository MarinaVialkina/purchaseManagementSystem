{"version":3,"file":"NotificationActions.js","names":["IconKebab","React","forwardRef","useCallback","useEffect","useRef","Button","ContextMenu","Text","withTooltip","useFlag","useForkRef","useMutableRef","getItemClick","withDefaultGetters","ButtonWithTooltip","size","NotificationActionsRender","props","ref","items","className","children","onlyIcon","opened","onOpenProp","onOpen","getItemIcon","getItemLabel","getItemOnClick","onItemClick","scrollContainerRef","title","otherProps","buttonRef","visibleMenu","setVisibleMenu","toggleMenu","e","stopPropagation","toggle","menuRef","elementZIndex","style","zIndex","current","addEventListener","off","removeEventListener","length","tooltipContent","NotificationActions"],"sources":["../../../../../../src/components/Notification/NotificationActions/NotificationActions.tsx"],"sourcesContent":["import { IconKebab } from '@consta/icons/IconKebab';\nimport React, { forwardRef, useCallback, useEffect, useRef } from 'react';\n\nimport { Button } from '##/components/Button';\nimport { ContextMenu } from '##/components/ContextMenu';\nimport { Text } from '##/components/Text';\nimport { withTooltip } from '##/hocs/withTooltip';\nimport { useFlag } from '##/hooks/useFlag';\nimport { useForkRef } from '##/hooks/useForkRef';\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { getItemClick } from '##/utils/getItemClick';\n\nimport { withDefaultGetters } from './helpers';\nimport {\n  NotificationActionsComponent,\n  NotificationActionsProps,\n} from './types';\n\nconst ButtonWithTooltip = withTooltip({ size: 's' })(Button);\n\nconst NotificationActionsRender = (\n  props: NotificationActionsProps,\n  ref: React.Ref<HTMLButtonElement>,\n) => {\n  const {\n    items = [],\n    className,\n    children,\n    onlyIcon,\n    opened = false,\n    onOpen: onOpenProp,\n    getItemIcon,\n    getItemLabel,\n    getItemOnClick,\n    onItemClick,\n    scrollContainerRef,\n    title,\n    ...otherProps\n  } = withDefaultGetters(props);\n\n  const buttonRef = useRef(null);\n\n  const [visibleMenu, setVisibleMenu] = useFlag(opened);\n\n  const toggleMenu = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation();\n      setVisibleMenu.toggle();\n    },\n    [setVisibleMenu],\n  );\n\n  const onOpen = useMutableRef(onOpenProp);\n  const menuRef = useForkRef([buttonRef, ref]);\n\n  const elementZIndex =\n    typeof props.style?.zIndex === 'number'\n      ? props.style.zIndex + 1\n      : undefined;\n\n  useEffect(() => {\n    setVisibleMenu[opened ? 'on' : 'off']();\n  }, [opened]);\n\n  useEffect(() => {\n    onOpen.current?.(visibleMenu);\n  }, [visibleMenu, onOpen]);\n\n  useEffect(() => {\n    if (scrollContainerRef?.current) {\n      scrollContainerRef.current.addEventListener('scroll', setVisibleMenu.off);\n    }\n    return () => {\n      if (scrollContainerRef?.current) {\n        scrollContainerRef.current.removeEventListener(\n          'scroll',\n          setVisibleMenu.off,\n        );\n      }\n    };\n  }, [scrollContainerRef]);\n\n  if (items.length === 1 && !onlyIcon) {\n    return (\n      <Button\n        {...otherProps}\n        className={className}\n        size=\"xs\"\n        view=\"clear\"\n        iconLeft={getItemIcon(items[0])}\n        onClick={getItemClick(items[0], getItemOnClick, onItemClick)}\n        label={getItemLabel(items[0])}\n        ref={ref}\n      />\n    );\n  }\n\n  if (items.length === 1 && getItemIcon(items[0]) && onlyIcon) {\n    return (\n      <ButtonWithTooltip\n        {...otherProps}\n        className={className}\n        size=\"xs\"\n        view=\"clear\"\n        iconLeft={getItemIcon(items[0])}\n        onClick={getItemClick(items[0], getItemOnClick, onItemClick)}\n        tooltipProps={{\n          tooltipContent: (\n            <Text view=\"primary\" size=\"xs\">\n              {getItemLabel(items[0])}\n            </Text>\n          ),\n        }}\n        ref={ref}\n      />\n    );\n  }\n\n  return (\n    <>\n      <Button\n        {...otherProps}\n        className={className}\n        size=\"xs\"\n        view=\"clear\"\n        iconLeft={IconKebab}\n        ref={menuRef}\n        onClick={toggleMenu}\n      />\n      <ContextMenu\n        role=\"listbox\"\n        offset=\"2xs\"\n        isOpen={visibleMenu}\n        size=\"s\"\n        items={items}\n        getItemLabel={getItemLabel}\n        onItemClick={onItemClick}\n        getItemOnClick={getItemOnClick}\n        getItemKey={getItemLabel}\n        getItemLeftIcon={getItemIcon}\n        anchorRef={buttonRef}\n        onClickOutside={setVisibleMenu.off}\n        possibleDirections={['downStartRight', 'upStartRight']}\n        direction=\"downStartRight\"\n        style={{ zIndex: elementZIndex }}\n      />\n    </>\n  );\n};\n\nexport const NotificationActions = forwardRef(\n  NotificationActionsRender,\n) as NotificationActionsComponent;\n"],"mappings":"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"}