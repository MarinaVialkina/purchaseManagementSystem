{"version":3,"file":"useVirtualScroll.js","names":["useEffect","useMemo","useRef","useState","useMutableRef","useRefs","useResizeObserved","arraysIsEq","calculateBounds","calculateSavedSizes","defaultItemsCalculationCount","getElementHeight","useCalculateVisiblePosition","useScroll","emptyArray","useVirtualScroll","length","onScrollToBottom","isActive","visiblePosition","setVisiblePosition","bounds","setBounds","listRefs","scrollElementRef","sizes","savedSizesRef","onScrollToBottomRef","scrollElementRefHeight","calculateVisiblePosition","current","state","resetVisiblePosition","resetBounds","slice","spaceTop"],"sources":["../../../../../src/hooks/useVirtualScroll/useVirtualScroll.ts"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react';\n\nimport { useMutableRef } from '##/hooks/useMutableRef';\nimport { useRefs } from '##/hooks/useRefs';\nimport { useResizeObserved } from '##/hooks/useResizeObserved';\n\nimport {\n  arraysIsEq,\n  Bounds,\n  calculateBounds,\n  calculateSavedSizes,\n  defaultItemsCalculationCount,\n  getElementHeight,\n  useCalculateVisiblePosition,\n  useScroll,\n  UseVirtualScrollProps,\n  UseVirtualScrollReturn,\n} from './helpers';\n\nconst emptyArray: [] = [];\n\nexport const useVirtualScroll = <\n  ITEM_ELEMENT extends HTMLElement = HTMLDivElement,\n  SCROLL_ELEMENT extends HTMLElement = HTMLDivElement,\n>({\n  length,\n  onScrollToBottom,\n  isActive = false,\n}: UseVirtualScrollProps): UseVirtualScrollReturn<\n  ITEM_ELEMENT,\n  SCROLL_ELEMENT\n> => {\n  const [visiblePosition, setVisiblePosition] = useState<[number, number]>([\n    0, 0,\n  ]);\n  const [bounds, setBounds] = useState<Bounds>([\n    [0, 0],\n    [0, isActive ? defaultItemsCalculationCount : length],\n  ]);\n  const listRefs = useRefs<ITEM_ELEMENT>(length, visiblePosition);\n  const scrollElementRef = useRef<SCROLL_ELEMENT>(null);\n  const sizes = useResizeObserved(\n    isActive ? listRefs : emptyArray,\n    getElementHeight,\n  );\n\n  const savedSizesRef = useRef(calculateSavedSizes([], sizes));\n  const onScrollToBottomRef = useMutableRef(onScrollToBottom);\n  const [scrollElementRefHeight] = useResizeObserved(\n    useMemo(() => {\n      return [scrollElementRef];\n    }, [scrollElementRef]),\n    getElementHeight,\n  );\n  const calculateVisiblePosition = useCalculateVisiblePosition(\n    scrollElementRef.current,\n    setVisiblePosition,\n    sizes,\n  );\n\n  useScroll(scrollElementRef, calculateVisiblePosition, isActive);\n\n  useEffect(() => {\n    if (isActive) {\n      calculateVisiblePosition();\n    }\n  }, [scrollElementRefHeight, isActive]);\n\n  useEffect(() => {\n    if (isActive) {\n      savedSizesRef.current = calculateSavedSizes(savedSizesRef.current, sizes);\n      setBounds(\n        calculateBounds(savedSizesRef.current, sizes, visiblePosition, length),\n      );\n    } else {\n      setBounds((state) => {\n        if (\n          state[0][0] !== 0 ||\n          state[0][1] !== 0 ||\n          state[1][0] !== 0 ||\n          state[1][1] !== length\n        ) {\n          return [\n            [0, 0],\n            [0, length],\n          ];\n        }\n        return state;\n      });\n    }\n  }, [...visiblePosition, sizes, length, isActive]);\n\n  useEffect(() => {\n    if (isActive && onScrollToBottomRef.current && bounds[1][1] + 1 >= length) {\n      onScrollToBottomRef.current(length);\n    }\n  }, [bounds[1][1], isActive]);\n\n  useEffect(() => {\n    const resetVisiblePosition: [number, number] = [0, 0];\n    const resetBounds: Bounds = [\n      [0, 0],\n      [0, isActive ? defaultItemsCalculationCount : length],\n    ];\n\n    setBounds((state) =>\n      arraysIsEq(state[0], resetBounds[0]) &&\n      arraysIsEq(state[1], resetBounds[1])\n        ? state\n        : resetBounds,\n    );\n\n    setVisiblePosition((state) =>\n      arraysIsEq(state, resetVisiblePosition) ? state : resetVisiblePosition,\n    );\n  }, [isActive]);\n\n  return {\n    listRefs,\n    scrollElementRef,\n    slice: bounds[1],\n    spaceTop: bounds[0][0],\n  };\n};\n"],"mappings":"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"}